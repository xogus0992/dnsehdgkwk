<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>운동 루틴 & 다이어트 지도</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #routineSection, #dietSection { display: none; }
    #exerciseList { margin-top: 20px; }
    .exercise-item { padding: 8px; border: 1px solid #ccc; margin-bottom: 5px; cursor: grab; }
  </style>
  <!-- ✅ 카카오 지도 API -->
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c96c999113980d67c697b2f5a3d385f1"></script>
</head>
<body>
  <h1>헬스 루틴 & 다이어트</h1>
  <button id="routineBtn">운동 루틴</button>
  <button id="dietBtn">다이어트</button>

  <!-- 운동 루틴 섹션 -->
  <div id="routineSection">
    <h2>운동 루틴</h2>
    <label for="exerciseSelect">운동 선택:</label>
    <select id="exerciseSelect"></select>
    <label for="weightInput">무게(kg):</label>
    <input type="number" id="weightInput" min="0" value="0">
    <label for="setsInput">세트 수:</label>
    <input type="number" id="setsInput" min="1" value="1">
    <button id="addExerciseBtn">추가</button>
    <div id="exerciseList"></div>
    <button onclick="goBack()">뒤로가기</button>
  </div>

  <!-- 다이어트 섹션 -->
  <div id="dietSection">
    <h2>다이어트 지도</h2>
    <div id="map" style="width:100%;height:400px;"></div>
    <button onclick="goBack()">뒤로가기</button>
  </div>

  <script>
    // ✅ 섹션 참조
    const routineSection = document.getElementById('routineSection');
    const dietSection = document.getElementById('dietSection');
    const exerciseSelect = document.getElementById('exerciseSelect');
    const exerciseList = document.getElementById('exerciseList');

    // ✅ 운동 데이터
    const exercisesData = {
      "가슴": ["벤치프레스", "인클라인 벤치프레스", "덤벨 플라이"],
      "등": ["풀업", "바벨 로우", "랫풀다운"],
      "어깨": ["숄더 프레스", "사이드 레터럴 레이즈", "리어 델트 플라이"],
      "하체": ["스쿼트", "레그 프레스", "런지"],
      "팔": ["바이셉 컬", "트라이셉 익스텐션", "딥스"]
    };

    let routines = [];
    let draggedIndex = null;

    // ✅ 운동 선택 박스 채우기
    const populateExercises = () => {
      const categories = ["가슴", "등", "어깨", "하체", "팔"];
      categories.forEach(category => {
        const optgroup = document.createElement('optgroup');
        optgroup.label = category;
        exercisesData[category].forEach(exercise => {
          const option = document.createElement('option');
          option.value = exercise;
          option.textContent = exercise;
          optgroup.appendChild(option);
        });
        exerciseSelect.appendChild(optgroup);
      });
    };

    // ✅ 운동 루틴 추가
    document.getElementById('addExerciseBtn').addEventListener('click', () => {
      const exercise = exerciseSelect.value;
      const weight = parseInt(document.getElementById('weightInput').value);
      const sets = parseInt(document.getElementById('setsInput').value);

      if (!exercise || sets <= 0 || weight < 0) {
        alert("운동과 세트 수, 무게를 올바르게 입력하세요.");
        return;
      }

      routines.push({ exercise, weight, sets });
      displayCurrentExercises();
    });

    // ✅ 운동 루틴 표시
    const displayCurrentExercises = () => {
      exerciseList.innerHTML = '';
      routines.forEach((routine, index) => {
        const div = document.createElement('div');
        div.className = 'exercise-item';
        div.draggable = true;
        div.dataset.index = index;
        div.textContent = `${routine.exercise} - 무게: ${routine.weight}kg, 세트: ${routine.sets}`;
        div.addEventListener('dragstart', () => { draggedIndex = index; });
        div.addEventListener('dragover', (e) => e.preventDefault());
        div.addEventListener('drop', () => {
          if (draggedIndex !== null && draggedIndex !== index) {
            const draggedItem = routines[draggedIndex];
            routines.splice(draggedIndex, 1);
            routines.splice(index, 0, draggedItem);
            displayCurrentExercises();
          }
        });
        exerciseList.appendChild(div);
      });
    };

    // ✅ 화면 이동
    function goBack() {
      routineSection.style.display = 'none';
      dietSection.style.display = 'none';
    }

    // ✅ 루틴 버튼
    document.getElementById('routineBtn').addEventListener('click', () => {
      routineSection.style.display = 'block';
      dietSection.style.display = 'none';
    });

    // ✅ 다이어트 버튼 (내 위치 기반 지도)
    document.getElementById('dietBtn').addEventListener('click', () => {
      routineSection.style.display = 'none';
      dietSection.style.display = 'block';
      initMap();
    });

    // ✅ 카카오 지도 (현재 위치 기반)
    function initMap() {
      const container = document.getElementById('map');
      const options = {
        center: new kakao.maps.LatLng(37.5665, 126.9780), // 기본: 서울시청
        level: 3
      };
      const map = new kakao.maps.Map(container, options);

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          const locPosition = new kakao.maps.LatLng(lat, lon);

          map.setCenter(locPosition);

          new kakao.maps.Marker({
            map: map,
            position: locPosition
          });
        }, () => {
          alert("위치 정보를 가져올 수 없습니다. 기본 위치(서울시청)로 표시됩니다.");
        });
      } else {
        alert("이 브라우저는 위치 정보를 지원하지 않습니다.");
      }
    }

    // ✅ 운동 선택 초기화
    populateExercises();
  </script>
</body>
</html>
