<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>ë‹¤ì´ì–´íŠ¸ ì›Œí‚¹ ë‚´ë¹„ê²Œì´ì…˜ + ì „êµ­ í¬ì¼“ëª¬ ì›”ë“œ</title>
<style>
html,body { width:100%; height:100%; margin:0; font-family: 'Malgun Gothic', sans-serif; }
.container { width:100%; height:100%; display:flex; flex-direction:column; }
#map { flex-grow:1; min-height:400px; }

/* ì•„ë˜ íŒ¨ë„ */
.info-panel { width:100%; padding:20px; background:white; box-shadow:0 -2px 6px rgba(0,0,0,0.1); box-sizing:border-box; z-index:10; overflow-y:auto; max-height:45%; }
.panel-header { display:flex; justify-content:center; align-items:center; margin-bottom:15px; position:relative; }
h2 { margin:0; font-size:1.4em; }
.version-tag { font-size:0.7em; background:#000; color:#fff; border-radius:6px; padding:2px 5px; margin-left:10px; }
#bodyStateBtn { position:absolute; right:0; top:50%; transform:translateY(-50%); padding:6px 10px; border:none; border-radius:5px; background:#6f42c1; color:#fff; cursor:pointer; }

.input-group { display:flex; gap:10px; margin-bottom:15px; flex-wrap:wrap; align-items:center; }
.input-wrapper { flex-grow:1; min-width:180px; position:relative; }
.input-wrapper::before { position:absolute; top:50%; left:10px; transform:translateY(-50%); font-weight:bold; color:#4caf50; }
.input-wrapper.start::before { content:'ì¶œë°œ'; }
.input-wrapper.end::before { content:'ë„ì°©'; }
.input-wrapper.target::before { content:'ğŸ‘Ÿ km'; }
input, select { width:100%; padding:10px; box-sizing:border-box; }
#calculated-calories { font-size:0.9em; color:#555; font-weight:bold; }
#searchBtn { padding:10px 20px; background:#4caf50; color:white; border:none; border-radius:5px; cursor:pointer; }

#result-area { display:flex; flex-wrap:wrap; gap:10px; }
.route-card { border:2px solid #ccc; border-radius:8px; padding:12px; flex:1 1 300px; background:#fafafa; }
.route-card.loop { border-color:#ffc107; }
.route-card.optimal { border-color:#007bff; }
.route-card.scenic-loop { border-color:#28a745; }
.route-card.trail-course { border-color:#6f42c1; }

/* í¬ì¼“ëª¬ ë§ˆì»¤ */
.pokemon-marker { display:flex; align-items:center; justify-content:center; width:44px; height:44px; border-radius:50%; background:white; box-shadow:0 2px 6px rgba(0,0,0,0.2); cursor:pointer; }
.pokemon-marker img { width:40px; height:40px; image-rendering:pixelated; }

/* í¬ì¼“ëª¬ ë„ê° ëª¨ë‹¬ */
.modal { display:none; position:fixed; z-index:2000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.4); }
.modal .box { width:800px; max-width:95%; margin:40px auto; background:#fff; border-radius:10px; padding:18px; }
.pokedex-list{ max-height:60vh; overflow:auto; }
.pokedex-item{ display:flex; gap:12px; align-items:center; padding:8px; border-bottom:1px solid #eee }
.pokedex-item img{ width:60px; height:60px; border-radius:8px; }
</style>
</head>
<body>
<div class="container">
  <div id="map"></div>
  <div class="info-panel">
    <div class="panel-header">
      <h2>ğŸ‘Ÿ ë§ì¶¤í˜• ê±·ê¸° ì½”ìŠ¤ + ì „êµ­ í¬ì¼“ëª¬ ì›”ë“œ <span class="version-tag">v1</span></h2>
      <button id="bodyStateBtn">ì˜¤ëŠ˜ ë‚˜ì˜ ëª¸ìƒíƒœ</button>
    </div>
    <div class="input-group">
      <div class="input-wrapper start"><input type="text" id="start" placeholder="ì¶œë°œì§€" autocomplete="off"><div id="start-suggestions"></div></div>
      <div class="input-wrapper end"><input type="text" id="end" placeholder="ë„ì°©ì§€ (ì„ íƒ)" autocomplete="off"><div id="end-suggestions"></div></div>
      <div class="input-wrapper target"><input type="number" id="targetDistance" placeholder="ëª©í‘œ ê±°ë¦¬(km)"></div>
      <span id="calculated-calories">ì•½ 0 kcal</span>
      <button id="searchBtn">ì½”ìŠ¤ ìƒì„±</button>
    </div>
    <div>
      <button id="btnShowPokedex">ë‚´ í¬ì¼“ëª¬ ë„ê° ì—´ê¸°</button>
      <button id="btnRegenerate">í¬ì¼“ëª¬ ìœ„ì¹˜ ì¬ë°°ì¹˜</button>
    </div>
    <div id="result-area"></div>
  </div>
</div>

<!-- ë„ê° ëª¨ë‹¬ -->
<div id="pokedexModal" class="modal">
  <div class="box">
    <h2>ë‚˜ì˜ í¬ì¼“ëª¬ ë„ê°</h2>
    <button id="btnClosePokedex">ë‹«ê¸°</button>
    <div id="pokedexList" class="pokedex-list"></div>
  </div>
</div>

<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c96c999113980d67c697b2f5a3d385f1&libraries=services"></script>
<script>
/* ========== ì§€ë„ ì´ˆê¸°í™” ========== */
const map = new kakao.maps.Map(document.getElementById('map'), { center:new kakao.maps.LatLng(37.5,126.9), level:6 });
const ps = new kakao.maps.services.Places();

/* ========== í¬ì¼“ëª¬ ì›”ë“œ ê´€ë ¨ ========== */
const CAPTURE_RADIUS_METERS=50;
let world=[], captured=[];
let markers={}; 

async function fetchPokemonData(id){ const r=await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`); if(!r.ok) return null; const j=await r.json(); return { id:j.id, name:j.name, sprite:j.sprites.front_default }; }

async function spawnPokemon(id,lat,lng){ 
  const pd=await fetchPokemonData(id); if(!pd) return;
  const item={ pokemonId:id, data:pd, position:{lat,lng}, uniqueId:`${id}-${Date.now()}` };
  world.push(item);
  const el=document.createElement('div'); el.className='pokemon-marker'; const img=document.createElement('img'); img.src=pd.sprite; el.appendChild(img);
  const ov=new kakao.maps.CustomOverlay({ position:new kakao.maps.LatLng(lat,lng), content:el, yAnchor:1 }); ov.setMap(map); markers[item.uniqueId]=ov;
  el.onclick=()=>capture(item);
}
function capture(item){ alert(item.data.name+" ì¡ì•˜ë‹¤!"); captured.push(item); renderPokedex(); markers[item.uniqueId].setMap(null); delete markers[item.uniqueId]; }

function renderPokedex(){ const list=document.getElementById('pokedexList'); list.innerHTML=''; if(!captured.length){list.innerHTML="<p>ì•„ì§ ì—†ìŒ</p>"; return;} captured.forEach(c=>{ const d=document.createElement('div'); d.className='pokedex-item'; d.innerHTML=`<img src="${c.data.sprite}"><div>${c.data.name}</div>`; list.appendChild(d); }); }

function randomSpawn(){ world=[]; Object.values(markers).forEach(m=>m.setMap(null)); markers={}; for(let i=1;i<=20;i++){ const lat=37+Math.random()*1, lng=126.5+Math.random()*1; spawnPokemon(i,lat,lng);} }
randomSpawn();

/* ë„ê° ëª¨ë‹¬ */
document.getElementById('btnShowPokedex').onclick=()=>{ document.getElementById('pokedexModal').style.display='block'; renderPokedex(); }
document.getElementById('btnClosePokedex').onclick=()=>document.getElementById('pokedexModal').style.display='none';
document.getElementById('btnRegenerate').onclick=()=>randomSpawn();

/* ========== ë‹¤ì´ì–´íŠ¸ ì½”ìŠ¤ ë¶€ë¶„ (ê°„ë‹¨ ë²„ì „) ========== */
const KCAL_PER_KM=60;
document.getElementById('targetDistance').oninput=()=>{ const d=parseFloat(document.getElementById('targetDistance').value)||0; document.getElementById('calculated-calories').innerText=`ì•½ ${Math.round(d*KCAL_PER_KM)} kcal`; };
</script>
</body>
</html>
