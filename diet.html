<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë‹¤ì´ì–´íŠ¸ ì§€ë„</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.3/dist/tailwind.min.css" rel="stylesheet" />
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c96c999113980d67c697b2f5a3d385f1&libraries=services,drawing&autoload=false"></script>
  <style>
    body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; }
  </style>
</head>
<body>

<!-- ì§€ë„ ì˜ì—­ -->
<div id="map" style="width: 100px; height: 100px;"></div>

<!-- UI ì˜ì—­ -->
<div class="absolute top-4 right-4 bg-white p-4 rounded shadow-md z-10 space-y-2">
  <div>
    <label class="block">ğŸ” ì˜¤ëŠ˜ ë¨¹ì€ ì¹¼ë¡œë¦¬ (kcal)</label>
    <input id="inputCalories" type="number" placeholder="ì˜ˆ: 500" class="border px-2 py-1 w-full" />
  </div>
  <div>
    <label class="block">âš–ï¸ ë‚´ ì²´ì¤‘ (kg)</label>
    <input id="inputWeight" type="number" placeholder="ì˜ˆ: 70" class="border px-2 py-1 w-full" />
  </div>
  <div>
    <label class="block">ğŸ¯ ëª©ì ì§€ (ìœ„ë„,ê²½ë„)</label>
    <input id="inputDest" type="text" placeholder="ì˜ˆ: 37.5665,126.9780" class="border px-2 py-1 w-full" />
  </div>
  <button id="recommendBtn" class="bg-green-500 text-white px-4 py-2 rounded w-full">ğŸ”¥ ì¶”ì²œ ê±°ë¦¬ ê³„ì‚°</button>
</div>

<!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
<button id="back-to-main-btn" class="absolute top-4 left-4 bg-white p-2 rounded-md shadow-lg z-10">
  â† ë’¤ë¡œê°€ê¸°
</button>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const backBtn = document.getElementById('back-to-main-btn');
    const recommendBtn = document.getElementById('recommendBtn');
    let kakaoMap = null;
    let userMarker = null;
    let userLatLng = null;
    let polylineA, polylineB, polylineC;

    const routeLengths = {
      a: 1.0, // km
      b: 2.0,
      c: 3.5
    };

    const calculateCalories = (weight, distanceKm) => {
      return (0.05 * weight * distanceKm).toFixed(2);
    };

    const drawRoute = (destLatLng, offsetLat, offsetLng, color) => {
      const linePath = [
        userLatLng,
        new kakao.maps.LatLng(
          (userLatLng.getLat() + destLatLng.getLat()) / 2 + offsetLat,
          (userLatLng.getLng() + destLatLng.getLng()) / 2 + offsetLng
        ),
        destLatLng
      ];

      const polyline = new kakao.maps.Polyline({
        path: linePath,
        strokeWeight: 5,
        strokeColor: color,
        strokeOpacity: 0.8,
        strokeStyle: 'solid'
      });

      polyline.setMap(kakaoMap);
      return polyline;
    };

    const initKakaoMap = () => {
      const container = document.getElementById('map');
      const defaultCenter = new kakao.maps.LatLng(37.5665, 126.9780);

      if (!kakaoMap) {
        const options = { center: defaultCenter, level: 5 };
        kakaoMap = new kakao.maps.Map(container, options);
      }

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((position) => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          userLatLng = new kakao.maps.LatLng(lat, lon);
          kakaoMap.setCenter(userLatLng);
          if (userMarker) userMarker.setMap(null);
          userMarker = new kakao.maps.Marker({ map: kakaoMap, position: userLatLng });
        }, () => {
          alert('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ìœ„ì¹˜ë¡œ í‘œì‹œë©ë‹ˆë‹¤.');
          userLatLng = defaultCenter;
        });
      }
    };

    // ì§€ë„ API ë¡œë“œ í›„ ì´ˆê¸°í™”
    kakao.maps.load(() => {
      initKakaoMap();
    });

    // ë’¤ë¡œê°€ê¸°
    backBtn.addEventListener('click', () => {
      window.location.href = 'index.html';
    });

    // ì¶”ì²œ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰
    recommendBtn.addEventListener('click', () => {
      const kcalInput = parseFloat(document.getElementById('inputCalories').value);
      const weight = parseFloat(document.getElementById('inputWeight').value);
      const destInput = document.getElementById('inputDest').value;

      if (!userLatLng) {
        alert("í˜„ì¬ ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        return;
      }

      if (isNaN(kcalInput) || isNaN(weight) || !destInput.includes(',')) {
        alert("ì…ë ¥ì„ ì •í™•íˆ í™•ì¸í•´ì£¼ì„¸ìš”.");
        return;
      }

      const [lat, lng] = destInput.split(',').map(Number);
      const destLatLng = new kakao.maps.LatLng(lat, lng);

      // ê¸°ì¡´ ë¼ì¸ ì œê±°
      [polylineA, polylineB, polylineC].forEach(p => p && p.setMap(null));

      // ì¹¼ë¡œë¦¬ ê³„ì‚°
      const calA = calculateCalories(weight, routeLengths.a);
      const calB = calculateCalories(weight, routeLengths.b);
      const calC = calculateCalories(weight, routeLengths.c);

      let message = '';
      if (kcalInput <= calA) {
        polylineA = drawRoute(destLatLng, 0.001, 0.001, 'green');
        message = `âœ… ìµœë‹¨ ê±°ë¦¬ A ì¶”ì²œ (${routeLengths.a} km, ì•½ ${calA} kcal ì†Œëª¨)`;
      } else if (kcalInput <= calB) {
        polylineB = drawRoute(destLatLng, 0.002, -0.001, 'green');
        message = `âœ… ì¤‘ê°„ ê±°ë¦¬ B ì¶”ì²œ (${routeLengths.b} km, ì•½ ${calB} kcal ì†Œëª¨)`;
      } else {
        polylineC = drawRoute(destLatLng, -0.002, 0.002, 'green');
        message = `âœ… ê¸´ ê±°ë¦¬ C ì¶”ì²œ (${routeLengths.c} km, ì•½ ${calC} kcal ì†Œëª¨)`;
      }

      alert(message);
    });
  });
</script>

</body>
</html>


