<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ë‹¤ì´ì–´íŠ¸ ì›Œí‚¹ ë‚´ë¹„ê²Œì´ì…˜ v3</title>
    <style>
        html, body {
            width: 100%; height: 100%; margin: 0; padding: 0;
            font-family: 'Malgun Gothic', dotum, 'ë‹ì›€', sans-serif; background-color: #f0f0f0;
        }
        .container { width: 100%; height: 100%; display: flex; flex-direction: column; }
        #map { width: 100%; flex-grow: 1; min-height: 400px; }
        .info-panel {
            width: 100%; padding: 20px; background-color: white;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1); box-sizing: border-box; z-index: 10;
            overflow-y: auto; max-height: 40%;
        }
        h2 { margin: 0 0 15px 0; font-size: 1.5em; color: #333; text-align: center; }
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .input-wrapper { flex-grow: 1; position: relative; }
        .input-wrapper::before {
            position: absolute; top: 50%; left: 12px; transform: translateY(-50%);
            font-weight: bold; color: #4CAF50;
        }
        .input-wrapper.start::before { content: 'ì¶œë°œ'; }
        .input-wrapper.end::before { content: 'ë„ì°©'; }
        
        input[type="text"] {
            width: 100%; padding: 12px 12px 12px 55px; border: 1px solid #ccc;
            border-radius: 5px; font-size: 1em; box-sizing: border-box;
        }
        
        #searchBtn {
            padding: 12px 25px; background-color: #4CAF50; color: white; border: none;
            border-radius: 5px; font-size: 1em; font-weight: bold; cursor: pointer;
            transition: background-color 0.2s;
        }
        #searchBtn:hover { background-color: #45a049; }

        #result-area {
            display: flex; gap: 10px; justify-content: center;
            flex-wrap: wrap; text-align: left;
        }
        .route-card {
            border: 2px solid #ddd; border-radius: 8px; padding: 15px;
            min-width: 250px; background-color: #f9f9f9;
        }
        .route-card h3 { margin: 0 0 10px 0; padding-bottom: 5px; border-bottom: 1px solid #eee; }
        .route-card p { margin: 5px 0; font-size: 1em; }
        .route-card b { font-size: 1.1em; }

        /* ê²½ë¡œë³„ ìƒ‰ìƒ ìŠ¤íƒ€ì¼ */
        .color-box { display: inline-block; width: 12px; height: 12px; margin-right: 5px; border-radius: 3px;}
        .color-green { background-color: #00FF00; }
        .color-yellow { background-color: #FFFF00; }
        .color-orange { background-color: #FFA500; }
        .color-blue { background-color: #0000FF; }
        
    </style>
</head>
<body>

<div class="container">
    <div id="map"></div>
    <div class="info-panel">
        <h2>ğŸƒâ€â™€ï¸ ì›í˜• ì½”ìŠ¤ ì¶”ì²œ</h2>
        <div class="input-group">
            <div class="input-wrapper start">
                <input type="text" id="start" placeholder="ì˜ˆ: ë¶€ì²œì‹œì²­">
            </div>
            <div class="input-wrapper end">
                <input type="text" id="end" placeholder="ì˜ˆ: ë¶€ì²œì—­">
            </div>
            <button id="searchBtn">ì½”ìŠ¤ ì¶”ì²œë°›ê¸°</button>
        </div>
        <div id="result-area">
            <p>ì¶œë°œì§€ì™€ ë„ì°©ì§€ë¥¼ ì…ë ¥í•˜ê³  ì½”ìŠ¤ë¥¼ ì¶”ì²œë°›ìœ¼ì„¸ìš”.</p>
        </div>
    </div>
</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c96c999113980d67c697b2f5a3d385f1&libraries=services"></script>
<script>
    const REST_API_KEY = '71b46fcb7202af130ab7c6c18bf5163a';
    const KCAL_PER_KM = 60; // 1kmë‹¹ ì†Œëª¨ ì¹¼ë¡œë¦¬

    const mapContainer = document.getElementById('map');
    const startInput = document.getElementById('start');
    const endInput = document.getElementById('end');
    const searchBtn = document.getElementById('searchBtn');
    const resultArea = document.getElementById('result-area');

    const map = new kakao.maps.Map(mapContainer, {
        center: new kakao.maps.LatLng(37.5034, 126.7661),
        level: 5
    });

    const ROUTE_COLORS = ["#FFFF00", "#FFA500", "#0000FF"]; // ë…¸ë‘, ì£¼í™©, íŒŒë‘

    let polylines = [];
    let markers = [];
    
    // ì¥ì†Œ ê²€ìƒ‰
    function searchPlace(query) {
        return new Promise((resolve, reject) => {
            if (!query.trim()) return reject(new Error("ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤."));
            new kakao.maps.services.Places().keywordSearch(query, (data, status) => {
                if (status === kakao.maps.services.Status.OK) {
                    resolve(new kakao.maps.LatLng(data[0].y, data[0].x));
                } else {
                    reject(new Error(`'${query}' ê²€ìƒ‰ ì‹¤íŒ¨`));
                }
            });
        });
    }

    // ê¸¸ì°¾ê¸° API (ëŒ€ì•ˆ ê²½ë¡œ í¬í•¨)
    async function getRouteAlternatives(origin, destination) {
        const url = `https://apis-navi.kakaomobility.com/v1/directions?origin=${origin.getLng()},${origin.getLat()}&destination=${destination.getLng()},${destination.getLat()}&priority=RECOMMEND&alternatives=true`;
        try {
            const response = await fetch(url, {
                method: 'GET',
                headers: { 'Authorization': `KakaoAK ${REST_API_KEY}` }
            });
            if (!response.ok) throw new Error(`HTTP ì—ëŸ¬: ${response.status}`);
            const data = await response.json();
            return data.routes || [];
        } catch (error) {
            console.error("ê¸¸ì°¾ê¸° API ì˜¤ë¥˜:", error);
            alert("ê¸¸ì°¾ê¸° ì„œë¹„ìŠ¤ì— ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            return [];
        }
    }
    
    function clearMap() {
        polylines.forEach(p => p.setMap(null));
        polylines = [];
        markers.forEach(m => m.setMap(null));
        markers = [];
    }

    function drawRoute(route, color) {
        const linePath = [];
        route.sections.forEach(s => s.roads.forEach(r => {
            for (let i = 0; i < r.vertexes.length; i += 2) {
                linePath.push(new kakao.maps.LatLng(r.vertexes[i+1], r.vertexes[i]));
            }
        }));
        const polyline = new kakao.maps.Polyline({
            path: linePath, strokeWeight: 7, strokeColor: color,
            strokeOpacity: 0.8, strokeStyle: 'solid'
        });
        polyline.setMap(map);
        polylines.push(polyline);
        return linePath;
    }

    function createResultCard(title, onewayRoute, returnRoute, colorClass) {
        const onewayDist = onewayRoute.summary.distance / 1000;
        const returnDist = returnRoute.summary.distance / 1000;
        const totalDist = onewayDist + returnDist;
        const totalDuration = Math.round((onewayRoute.summary.duration + returnRoute.summary.duration) / 60);
        const totalCalories = Math.round(totalDist * KCAL_PER_KM);

        return `
            <div class="route-card">
                <h3><span class="color-box ${colorClass}"></span>${title}</h3>
                <p>ì´ ê±°ë¦¬: <b>${totalDist.toFixed(2)} km</b></p>
                <p>ì˜ˆìƒ ì‹œê°„: <b>${totalDuration} ë¶„</b></p>
                <p>ì†Œëª¨ ì¹¼ë¡œë¦¬: <b>${totalCalories} kcal</b></p>
            </div>
        `;
    }

    async function searchAndNavigate() {
        if (!startInput.value || !endInput.value) {
            alert('ì¶œë°œì§€ì™€ ë„ì°©ì§€ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            return;
        }
        
        clearMap();
        resultArea.innerHTML = '<p>ìµœì ì˜ ì›í˜• ì½”ìŠ¤ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...</p>';

        try {
            const [startCoords, endCoords] = await Promise.all([
                searchPlace(startInput.value), searchPlace(endInput.value)
            ]);

            const [onewayRoutes, returnRoutes] = await Promise.all([
                getRouteAlternatives(startCoords, endCoords),
                getRouteAlternatives(endCoords, startCoords)
            ]);

            if (onewayRoutes.length === 0 || returnRoutes.length === 0) {
                resultArea.innerHTML = '<p>ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¥ì†Œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.</p>';
                return;
            }

            const onewayRoute = onewayRoutes[0]; // ê°€ëŠ” ê¸¸ì€ ì²«ë²ˆì§¸ ê²½ë¡œë¡œ ê³ ì •
            const bounds = new kakao.maps.LatLngBounds();
            
            // 1. ê°€ëŠ” ê¸¸ ê·¸ë¦¬ê¸° (ì´ˆë¡ìƒ‰)
            const onewayPath = drawRoute(onewayRoute, '#00FF00');
            onewayPath.forEach(p => bounds.extend(p));

            let resultHTML = "";

            // 2. ì˜¤ëŠ” ê¸¸ë“¤ ê·¸ë¦¬ê¸° (ìµœëŒ€ 3ê°œ: ê¸°ë³¸1 + ì¶”ì²œ2)
            for (let i = 0; i < returnRoutes.length && i < 3; i++) {
                const returnRoute = returnRoutes[i];
                const color = ROUTE_COLORS[i];
                const path = drawRoute(returnRoute, color);
                path.forEach(p => bounds.extend(p));

                let title = i === 0 ? "ê¸°ë³¸ ì™•ë³µ ì½”ìŠ¤" : `ì¶”ì²œ ì›í˜• ì½”ìŠ¤ ${i}`;
                let colorClass = i === 0 ? "color-yellow" : i === 1 ? "color-orange" : "color-blue";
                resultHTML += createResultCard(title, onewayRoute, returnRoute, colorClass);
            }

            resultArea.innerHTML = resultHTML;

            // ë§ˆì»¤ ë° ì§€ë„ ë²”ìœ„ ì„¤ì •
            const startMarker = new kakao.maps.Marker({ position: startCoords, title: 'ì¶œë°œì§€' });
            const endMarker = new kakao.maps.Marker({ position: endCoords, title: 'ë„ì°©ì§€' });
            startMarker.setMap(map);
            endMarker.setMap(map);
            markers.push(startMarker, endMarker);
            map.setBounds(bounds);

        } catch (error) {
            alert(error.message);
            resultArea.innerHTML = '<p>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>';
        }
    }

    searchBtn.addEventListener('click', searchAndNavigate);
    [startInput, endInput].forEach(input => {
        input.addEventListener('keydown', (e) => e.key === 'Enter' && searchBtn.click());
    });

</script>

</body>
</html>