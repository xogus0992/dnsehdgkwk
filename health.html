<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>health</title>

  <!-- Tailwind -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="health.css" />
  <script src="exercises.js"></script>
</head>

<body class="bg-gray-50 text-gray-900">

<!-- ============================
     APP WRAPPER
=============================== -->
<div class="max-w-md mx-auto h-screen flex flex-col bg-white relative">

  <!-- ============================
       HEADER
  =============================== -->
  <header class="fixed top-0 left-0 right-0 z-40 max-w-md mx-auto h-14 bg-white border-b border-gray-200 flex items-center justify-between px-4">
    <div class="leading-tight">
      <div class="text-xs text-gray-500" id="top-subtitle">오늘의 운동</div>
      <div class="font-semibold text-lg" id="top-title">나의 운동 기록</div>
    </div>
    <button id="reset-data-btn" class="px-3 py-1 text-xs rounded-full bg-blue-100 text-blue-700">초기화</button>
  </header>

  <!-- ============================
       MAIN CONTENT
  =============================== -->
  <main class="pt-16 pb-20 overflow-y-auto">

    <!-- ============================================================
         PAGE: CALENDAR
    =============================================================== -->
    <section id="page-calendar" class="page page-active px-4 space-y-4">

      <!-- 오늘 요약 -->
      <div class="bg-white rounded-2xl shadow-sm p-4 flex justify-between items-center">
        <div>
          <div class="text-xs text-gray-500">선택한 날짜</div>
          <div id="selected-date-label" class="text-lg font-semibold">-</div>
        </div>
        <div class="text-right text-sm text-gray-700">
          <div>총 볼륨 <span id="selected-date-volume" class="font-semibold text-blue-600">0kg</span></div>
          <div>운동 <span id="selected-date-exercise-count" class="font-semibold text-blue-600">0개</span></div>
        </div>
      </div>

      <!-- 캘린더 -->
      <div class="bg-white rounded-2xl shadow-sm p-4">
        <div class="flex justify-between items-center mb-3">
          <button id="prev-month-btn" class="px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded-full">이전</button>
          <div id="calendar-title" class="font-semibold"></div>
          <button id="next-month-btn" class="px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded-full">다음</button>
        </div>

        <div class="grid grid-cols-7 text-center text-xs text-gray-500 mb-2">
          <div>일</div><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div>토</div>
        </div>

        <div id="calendar" class="grid grid-cols-7 gap-1 text-sm"></div>

        <div class="flex justify-between items-center mt-3">
          <div class="flex space-x-2">
            <button id="today-btn" class="px-3 py-1 text-xs border border-gray-300 text-blue-600 rounded-full">오늘</button>
            <label class="px-3 py-1 text-xs border border-gray-300 text-blue-600 rounded-full cursor-pointer">
              날짜 검색
              <input id="date-search-input" type="date" class="hidden">
            </label>
          </div>
          <button id="open-stats-modal-btn" class="px-3 py-1 bg-blue-500 text-white text-xs rounded-full">기간 통계</button>
        </div>
      </div>

    </section>

    <!-- ============================================================
         PAGE: ROUTINES (템플릿 + 편집)
    =============================================================== -->
    <section id="page-routines" class="page hidden px-4 space-y-4">

      <div class="flex justify-between items-center">
        <h2 class="font-semibold text-base">루틴 템플릿</h2>
        <button id="create-new-template-btn" class="px-3 py-1 text-xs bg-blue-500 text-white rounded-full">새 루틴</button>
      </div>

      <p class="text-xs text-gray-500">
        자주 사용하는 루틴을 저장해두고 세션에서 불러올 수 있어요.
      </p>

      <div id="routine-template-list" class="space-y-3"></div>

    </section>

    <!-- ============================================================
         PAGE: SESSION (운동 세션)
    =============================================================== -->
    <section id="page-session" class="page hidden px-4 space-y-4">

      <!-- 날짜 카드 -->
      <div class="bg-white rounded-2xl shadow-sm p-4 flex justify-between items-center">
        <div>
          <div class="text-xs text-gray-500">세션 날짜</div>
          <div id="session-date-label" class="font-semibold text-lg">-</div>
        </div>
        <div class="text-right text-xs text-gray-700">
          <div>총 시간 <span id="session-total-timer-display" class="font-semibold text-blue-600">00:00:00</span></div>
          <div>총 볼륨 <span id="session-total-volume" class="font-semibold text-blue-600">0kg</span></div>
          <div>운동 <span id="session-exercise-count" class="font-semibold text-blue-600">0개</span></div>
        </div>
      </div>

      <!-- 세션 버튼 -->
      <div class="grid grid-cols-3 gap-2">
        <button id="open-add-exercise-modal-btn" class="col-span-2 bg-blue-500 text-white rounded-2xl py-3">운동 추가</button>
        <button id="open-timer-modal-btn" class="border border-blue-300 text-blue-600 rounded-2xl py-3 bg-white">타이머</button>
      </div>

      <!-- 운동 섹션 -->
      <div id="workout-session-list" class="space-y-4"></div>

    </section>

    <!-- ============================================================
         PAGE: STATS (통계)
    =============================================================== -->
    <section id="page-stats" class="page hidden px-4 space-y-4">

      <h2 class="font-semibold text-base">운동 통계</h2>

      <div class="bg-white rounded-2xl shadow-sm p-4">
        <div class="text-xs text-gray-500 mb-2">기간 선택</div>
        <div class="flex space-x-2">
          <button id="stats-range-7" class="flex-1 border border-blue-200 text-blue-600 rounded-full text-xs py-1">7일</button>
          <button id="stats-range-30" class="flex-1 border border-blue-200 text-blue-600 rounded-full text-xs py-1">30일</button>
          <button id="stats-range-all" class="flex-1 border border-blue-200 text-blue-600 rounded-full text-xs py-1">전체</button>
        </div>
      </div>

      <div class="bg-white rounded-2xl shadow-sm p-4">
        <div class="flex justify-between items-center mb-2">
          <span class="text-xs text-gray-500">부위별 볼륨</span>
          <span id="stats-period-label" class="text-xs text-gray-400"></span>
        </div>
        <div id="stats-bodypart-list" class="space-y-2"></div>
      </div>

      <div class="bg-white rounded-2xl shadow-sm p-4">
        <div class="flex justify-between items-center mb-2">
          <span class="text-xs text-gray-500">최근 PR</span>
          <button id="open-pr-modal-btn" class="text-xs text-blue-600 underline">전체 보기</button>
        </div>
        <div id="pr-list" class="space-y-2"></div>
      </div>

    </section>

  </main>

  <!-- ============================================================
       NAVIGATION BAR
  =============================================================== -->
  <nav class="fixed bottom-0 left-0 right-0 max-w-md mx-auto h-16 bg-white border-t border-gray-200 flex justify-around items-center z-50">

    <button class="nav-btn flex flex-col items-center text-gray-500" data-page="calendar">
      <span class="material-icons text-xl">calendar_month</span>
      <span class="text-[10px]">캘린더</span>
    </button>

    <button class="nav-btn flex flex-col items-center text-gray-500" data-page="routines">
      <span class="material-icons text-xl">list_alt</span>
      <span class="text-[10px]">루틴</span>
    </button>

    <button class="nav-btn flex flex-col items-center text-gray-500" data-page="session">
      <span class="material-icons text-xl">fitness_center</span>
      <span class="text-[10px]">세션</span>
    </button>

    <button class="nav-btn flex flex-col items-center text-gray-500" data-page="stats">
      <span class="material-icons text-xl">bar_chart</span>
      <span class="text-[10px]">통계</span>
    </button>

  </nav>

  <!-- ============================
       MODALS (전체 기능 지원)
  =============================== -->

  <!-- 운동 선택 모달 -->
  <div id="add-to-session-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-40 flex items-end justify-center z-50">
    <div class="w-full max-w-md bg-white rounded-t-3xl p-5 max-h-[80vh] overflow-y-auto space-y-4">

      <div class="flex justify-between items-center">
        <h3 class="font-semibold">운동 선택</h3>
        <button id="cancel-add-exercise-btn" class="text-xs text-gray-500">닫기</button>
      </div>

      <!-- 검색 -->
      <input id="session-search-input" type="text" placeholder="운동 검색..." class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">

      <!-- 부위별 필터 -->
      <div id="session-part-filter" class="flex flex-wrap gap-2 text-xs"></div>

      <!-- 운동 리스트 -->
      <div id="session-exercise-select" class="space-y-2 text-sm"></div>

    </div>
  </div>

  <!-- 커스텀 운동 추가 -->
  <div id="add-exercise-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-40 flex items-end justify-center z-50">
    <div class="w-full max-w-md bg-white rounded-t-3xl p-5 max-h-[70vh] overflow-y-auto space-y-4">

      <div class="flex justify-between items-center">
        <h3 class="font-semibold">새 운동 추가</h3>
        <button id="close-add-exercise-modal-btn" class="text-xs text-gray-500">닫기</button>
      </div>

      <div>
        <label class="text-xs text-gray-600">운동 이름</label>
        <input id="new-exercise-name" type="text" class="w-full border border-gray-300 rounded-lg px-3 py-2 mt-1" placeholder="예: 바벨 로우">
      </div>

      <div>
        <label class="text-xs text-gray-600">부위</label>
        <select id="new-exercise-part" class="w-full border border-gray-300 rounded-lg px-3 py-2 mt-1 bg-white"></select>
      </div>

      <button id="add-update-exercise-btn" class="w-full bg-blue-500 text-white rounded-xl py-2">저장</button>

    </div>
  </div>

  <!-- 세트 편집 모달 -->
  <div id="edit-set-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
    <div class="w-11/12 max-w-md bg-white rounded-2xl p-5 space-y-4">

      <div class="flex justify-between items-center">
        <h3 class="font-semibold">세트 수정</h3>
        <button id="close-edit-set-modal-btn" class="text-xs text-gray-500">닫기</button>
      </div>

      <div class="grid grid-cols-3 gap-3">
        <div>
          <label class="text-xs text-gray-500">중량(kg)</label>
          <input id="edit-weight-input" type="number" min="0" class="w-full border border-gray-300 rounded-lg px-2 py-1 text-center mt-1">
        </div>
        <div>
          <label class="text-xs text-gray-500">횟수</label>
          <input id="edit-reps-input" type="number" min="1" class="w-full border border-gray-300 rounded-lg px-2 py-1 text-center mt-1">
        </div>
        <div>
          <label class="text-xs text-gray-500">완료</label>
          <select id="edit-done-input" class="w-full border border-gray-300 rounded-lg px-2 py-1 text-center mt-1">
            <option value="false">미완</option>
            <option value="true">완료</option>
          </select>
        </div>
      </div>

      <div class="flex justify-between">
        <button id="duplicate-set-btn" class="flex-1 bg-blue-100 text-blue-600 rounded-xl py-2 mr-2">세트 복사</button>
        <button id="delete-set-btn" class="flex-1 bg-red-100 text-red-600 rounded-xl py-2">세트 삭제</button>
      </div>

      <button id="apply-set-edit-btn" class="w-full bg-blue-500 text-white rounded-xl py-2 mt-3">적용</button>

    </div>
  </div>

  <!-- 타이머 모달 -->
  <div id="timer-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
    <div class="w-11/12 max-w-md bg-white rounded-3xl p-6 space-y-4">
      <div class="flex justify-between items-center">
        <h3 class="font-semibold">휴식 타이머</h3>
        <button id="close-timer-modal-btn" class="text-xs text-gray-500">닫기</button>
      </div>

      <div id="timer-digital-display" class="text-center text-3xl font-mono text-blue-700">01:00</div>

      <div class="flex justify-center gap-2">
        <button id="timer-minus-30" class="px-3 py-1 bg-gray-100 rounded-lg text-xs">-30</button>
        <button id="timer-minus-10" class="px-3 py-1 bg-gray-100 rounded-lg text-xs">-10</button>
        <button id="timer-plus-10" class="px-3 py-1 bg-gray-100 rounded-lg text-xs">+10</button>
        <button id="timer-plus-30" class="px-3 py-1 bg-gray-100 rounded-lg text-xs">+30</button>
      </div>

      <input id="timer-input" type="number" min="10" max="600" class="w-full text-center border border-gray-300 rounded-lg px-3 py-2" />

      <button id="start-stop-timer-btn" class="w-full bg-blue-500 text-white rounded-xl py-2">시작</button>
    </div>
  </div>

  <!-- Floating Timer -->
  <div id="floating-timer" class="hidden fixed bottom-20 right-4 z-50">
    <div class="bg-blue-500 text-white px-3 py-2 rounded-full shadow-lg flex items-center gap-2 text-xs">
      <span id="floating-timer-display">01:00</span>
      <button id="close-floating-timer" class="text-[10px] opacity-80">닫기</button>
    </div>
  </div>

  <!-- Summary 모달 -->
  <div id="summary-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
    <div class="w-11/12 max-w-md bg-white rounded-3xl p-6 space-y-4">
      <div class="flex justify-between items-center">
        <h3 class="font-semibold">오늘의 요약</h3>
        <button id="close-summary-modal-btn" class="text-xs text-gray-500">닫기</button>
      </div>

      <div id="summary-content" class="space-y-2"></div>
      <button id="save-summary-btn" class="w-full bg-blue-500 text-white rounded-xl py-2">저장</button>
    </div>
  </div>

  <!-- PR Celebration Modal -->
  <div id="pr-celebration-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
    <div class="w-11/12 max-w-md bg-white rounded-3xl p-6 text-center space-y-4">
      <div class="text-sm text-blue-600 font-semibold">Personal Record</div>
      <div class="text-2xl font-bold text-gray-800">PR 달성!</div>
      <div id="pr-celebration-list" class="space-y-1 text-sm"></div>
      <button id="close-pr-modal" class="w-full bg-blue-500 text-white rounded-xl py-2">확인</button>
    </div>
  </div>

  <!-- Daily Log 모달 -->
  <div id="daily-log-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
    <div class="w-11/12 max-w-md bg-white rounded-3xl p-6 space-y-4">
      <div class="flex justify-between items-center">
        <h3 id="daily-log-modal-title" class="font-semibold">일일 기록</h3>
        <button id="close-daily-log-modal-btn" class="text-xs text-gray-500">닫기</button>
      </div>

      <div id="daily-log-modal-list" class="space-y-2 max-h-[60vh] overflow-y-auto"></div>
    </div>
  </div>

</div> <!-- END WRAPPER -->

<!-- 외부 라이브러리 -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<!-- 메인 JS -->
<script src="health.js"></script>

</body>
</html>
