<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‹¤ì´ì–´íŠ¸ ë‚´ë¹„ê²Œì´ì…˜ - Kakao ê¸¸ì°¾ê¸° ë²„ì „</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet" />
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c96c999113980d67c697b2f5a3d385f1&libraries=services"></script>
  
  <style>
    :root {
      --primary: #2563eb;
      --primary-soft: #dbeafe;
      --bg: #f3f4f6;
      --card-bg: #ffffff;
      --border: #e5e7eb;
      --text-main: #111827;
      --text-sub: #6b7280;
      --danger: #ef4444;
      --success: #10b981;
      
      /* ì¸ìŠ¤íƒ€ ìŠ¤íƒ€ì¼ ë³€ìˆ˜ ì¶”ê°€ */
      --insta-story-ring: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      font-family: "Noto Sans KR", sans-serif;
      background: var(--bg);
      color: var(--text-main);
      height: 100vh; display: flex; flex-direction: column;
    }

    .app-header {
      padding: 16px; background: var(--card-bg);
      border-bottom: 1px solid var(--border);
      text-align: center; font-weight: 700; font-size: 1.1rem;
      position: sticky; top: 0; z-index: 50;
    }

    .app-main { flex: 1; overflow-y: auto; padding: 16px; padding-bottom: 80px; }

    /* ê¸°ì¡´ ì¹´ë“œ ìŠ¤íƒ€ì¼ ìœ ì§€ */
    .card {
      background: var(--card-bg); border-radius: 12px; padding: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 16px;
    }
    .card-title { font-weight: 700; margin-bottom: 12px; font-size: 1rem; display:flex; justify-content:space-between; align-items:center; }

    /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ ìœ ì§€ */
    .input-group { margin-bottom: 12px; }
    .input-label { display: block; font-size: 0.85rem; color: var(--text-sub); margin-bottom: 4px; }
    .form-input {
      width: 100%; padding: 10px; border: 1px solid var(--border);
      border-radius: 8px; font-size: 0.95rem; outline: none;
    }
    .form-input:focus { border-color: var(--primary); }
    
    .btn-row { display: flex; gap: 8px; }
    .btn {
      flex: 1; padding: 10px; border: none; border-radius: 8px;
      font-weight: 600; cursor: pointer; font-size: 0.9rem;
      transition: opacity 0.2s;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-secondary { background: white; border: 1px solid var(--border); color: var(--text-main); }
    .btn:active { opacity: 0.8; }
    .btn:disabled { background: #ccc; cursor: not-allowed; }

    /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ìœ ì§€ */
    .tab-nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: var(--card-bg); border-top: 1px solid var(--border);
      display: flex; height: 60px; z-index: 100;
    }
    .tab-item {
      flex: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      color: var(--text-sub); font-size: 0.75rem; gap: 4px;
      cursor: pointer;
    }
    .tab-item.active { color: var(--primary); font-weight: 600; }
    .tab-icon { font-size: 1.4rem; }

    .page { display: none; }
    .page.active { display: block; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    #map { width: 100%; height: 300px; background: #eee; border-radius: 8px; margin-bottom: 12px; }
    
    .message { font-size: 0.9rem; padding: 10px; border-radius: 8px; background: #eef2ff; color: #333; margin-top: 10px; }
    .message.error { background: #fee2e2; color: #b91c1c; }

    /* ------------------------------------------------------- */
    /* [NEW] ì¸ìŠ¤íƒ€ê·¸ë¨ ìŠ¤íƒ€ì¼ í”„ë¡œí•„ CSS (ì—¬ê¸°ê°€ ì¶”ê°€ëœ ë¶€ë¶„) */
    /* ------------------------------------------------------- */
    .insta-profile-header {
      display: flex; align-items: center; margin-bottom: 20px;
    }
    .insta-avatar-wrap {
      position: relative; margin-right: 20px;
    }
    .insta-avatar {
      width: 80px; height: 80px; border-radius: 50%;
      background: var(--insta-story-ring);
      padding: 2px; /* ë§ ë‘ê»˜ */
    }
    .insta-avatar img, .insta-avatar-placeholder {
      width: 100%; height: 100%; border-radius: 50%;
      border: 2px solid #fff;
      background: #f0f0f0; object-fit: cover;
      display: flex; align-items: center; justify-content: center;
      font-size: 2rem;
    }
    .insta-stats {
      flex: 1; display: flex; justify-content: space-around; text-align: center;
    }
    .insta-stat-item { display: flex; flex-direction: column; }
    .insta-stat-num { font-weight: 700; font-size: 1.1rem; color: var(--text-main); }
    .insta-stat-label { font-size: 0.8rem; color: var(--text-main); }

    .insta-bio { margin-bottom: 16px; padding-left: 4px; }
    .insta-bio-name { font-weight: 700; font-size: 0.95rem; }
    .insta-bio-text { font-size: 0.9rem; white-space: pre-wrap; margin-top: 4px; }
    .insta-bio-link { color: #00376b; text-decoration: none; font-size: 0.9rem; }

    .insta-actions { display: flex; gap: 8px; margin-bottom: 20px; }
    .insta-btn {
      flex: 1; background: #efefef; border: none; border-radius: 6px;
      padding: 6px 0; font-weight: 600; font-size: 0.9rem;
      color: var(--text-main); cursor: pointer;
    }

    /* í•˜ì´ë¼ì´íŠ¸ (ë°°ì§€) */
    .insta-highlights {
      display: flex; gap: 16px; overflow-x: auto; padding-bottom: 10px;
      scrollbar-width: none; margin-bottom: 10px;
    }
    .insta-highlights::-webkit-scrollbar { display: none; }
    .highlight-item { display: flex; flex-direction: column; align-items: center; min-width: 64px; }
    .highlight-circle {
      width: 56px; height: 56px; border-radius: 50%; border: 1px solid #dbdbdb;
      padding: 2px; margin-bottom: 4px;
    }
    .highlight-inner {
      width: 100%; height: 100%; border-radius: 50%; background: #fafafa;
      display: flex; align-items: center; justify-content: center; font-size: 1.5rem;
    }
    .highlight-text { font-size: 0.75rem; color: var(--text-main); }

    /* ê·¸ë˜í”„ ì»¨í…Œì´ë„ˆ */
    .chart-wrapper {
      background: #fff; border-radius: 12px; padding: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 20px;
      border: 1px solid #efefef;
    }
  </style>
</head>
<body>

  <header class="app-header">
    ëŸ¬ë‹ ë‚´ë¹„ê²Œì´ì…˜
  </header>

  <main class="app-main">
    <div id="page-home" class="page active">
      <div class="card">
        <div class="card-title">ëŸ¬ë‹ ì½”ìŠ¤ ìƒì„±</div>
        
        <div class="input-group">
          <label class="input-label">ì¶œë°œì§€</label>
          <input type="text" id="start-input" class="form-input" placeholder="ì˜ˆ: ê°•ë‚¨ì—­, í•œê°•ê³µì›" />
        </div>

        <div class="input-group">
          <label class="input-label">ë„ì°©ì§€ (ì„ íƒ)</label>
          <input type="text" id="end-input" class="form-input" placeholder="ë¹„ì›Œë‘ë©´ ì¶œë°œì§€ë¡œ ëŒì•„ì˜´ (ì™•ë³µ)" />
        </div>

        <div class="input-group">
          <label class="input-label">ëª©í‘œ ê±°ë¦¬ (km) / ì™•ë³µ ì‹œ</label>
          <input type="number" id="loop-distance" class="form-input" value="3" step="0.5" />
        </div>

        <div class="btn-row">
          <button id="btn-search-route" class="btn btn-primary">ê²½ë¡œ ì°¾ê¸°</button>
          <button id="btn-loop-route" class="btn btn-secondary">ëœë¤ ë£¨í”„</button>
        </div>
        <div id="route-msg" class="message" style="display:none;"></div>
      </div>

      <div class="card">
        <div class="card-title">
          <span>ì§€ë„ ë¯¸ë¦¬ë³´ê¸°</span>
          <span id="map-info" style="font-size:0.8rem; color:var(--primary); font-weight:400;"></span>
        </div>
        <div id="map"></div>
        <button id="btn-save-route" class="btn btn-primary" style="width:100%;" disabled>
          ì´ ì½”ìŠ¤ ì €ì¥í•˜ê¸°
        </button>
      </div>
    </div>

    <div id="page-history" class="page">
      <div class="card">
        <div class="card-title">ì €ì¥ëœ ì½”ìŠ¤ ëª©ë¡</div>
        <ul id="history-list" style="padding-left: 20px; margin: 0; color: var(--text-sub);">
          <li>ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</li>
        </ul>
      </div>
    </div>

    <div id="page-group" class="page">
      <div class="card">
        <div class="card-title">ëŸ¬ë‹ í¬ë£¨ ë­í‚¹</div>
        <div id="group-list"></div>
      </div>
    </div>

    <div id="page-me" class="page">
      <div class="card" style="border:none; box-shadow:none; background:transparent; padding:0;">
        <div class="insta-profile-header">
          <div class="insta-avatar-wrap">
            <div class="insta-avatar">
              <div class="insta-avatar-placeholder">ğŸƒ</div>
            </div>
          </div>
          <div class="insta-stats">
            <div class="insta-stat-item">
              <span class="insta-stat-num" id="profile-total-run">0</span>
              <span class="insta-stat-label">ëŸ¬ë‹ íšŸìˆ˜</span>
            </div>
            <div class="insta-stat-item">
              <span class="insta-stat-num" id="profile-total-km">0.0</span>
              <span class="insta-stat-label">ëˆ„ì  km</span>
            </div>
            <div class="insta-stat-item">
              <span class="insta-stat-num" id="profile-saved-count">0</span>
              <span class="insta-stat-label">ì €ì¥ ì½”ìŠ¤</span>
            </div>
          </div>
        </div>

        <div class="insta-bio">
          <div class="insta-bio-name">ë‚˜ë§Œì˜ ëŸ¬ë‹ ê¸°ë¡ ğŸš©</div>
          <div class="insta-bio-text">ì˜¤ëŠ˜ë„ ë‹¬ë¦¬ëŠ” ì¤‘ ğŸƒâ€â™‚ï¸ğŸ’¨
ëª©í‘œ: ì´ë²ˆ ë‹¬ 50km ë‹¬ì„±í•˜ê¸°!
#ì˜¤ìš´ì™„ #ëŸ¬ë‹ìŠ¤íƒ€ê·¸ë¨</div>
        </div>

        <div class="insta-actions">
          <button class="insta-btn" onclick="alert('í”„ë¡œí•„ í¸ì§‘ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘')">í”„ë¡œí•„ í¸ì§‘</button>
          <button class="insta-btn" onclick="alert('ê³µìœ  ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘')">í”„ë¡œí•„ ê³µìœ </button>
        </div>

        <div class="insta-highlights">
          <div class="highlight-item">
            <div class="highlight-circle"><div class="highlight-inner">ğŸ”¥</div></div>
            <span class="highlight-text">ì—°ì† 3ì¼</span>
          </div>
          <div class="highlight-item">
            <div class="highlight-circle"><div class="highlight-inner">ğŸ‘Ÿ</div></div>
            <span class="highlight-text">ìƒˆ ì‹ ë°œ</span>
          </div>
          <div class="highlight-item">
            <div class="highlight-circle"><div class="highlight-inner">ğŸ¥‡</div></div>
            <span class="highlight-text">ì²« 10K</span>
          </div>
          <div class="highlight-item">
            <div class="highlight-circle"><div class="highlight-inner">â›°ï¸</div></div>
            <span class="highlight-text">ë“±ì‚°</span>
          </div>
        </div>
      </div>

      <div class="chart-wrapper">
        <div class="card-title" style="margin-bottom:16px;">ğŸ“Š ì£¼ê°„ í™œë™ ê·¸ë˜í”„</div>
        <div style="height: 200px;">
          <canvas id="activityChart"></canvas>
        </div>
      </div>

      <div style="text-align: center; margin-top: 20px;">
        <button id="btn-reset-stats" class="btn btn-secondary" style="font-size: 0.8rem; padding: 6px 12px; color: var(--danger); border-color: var(--danger);">
          ë°ì´í„° ì´ˆê¸°í™”
        </button>
      </div>
    </div>

  </main>

  <nav class="tab-nav">
    <div class="tab-item active" data-target="page-home">
      <span class="tab-icon">ğŸ </span>
      <span>í™ˆ</span>
    </div>
    <div class="tab-item" data-target="page-history">
      <span class="tab-icon">ğŸ“</span>
      <span>ê¸°ë¡</span>
    </div>
    <div class="tab-item" data-target="page-group">
      <span class="tab-icon">ğŸ‘¥</span>
      <span>í¬ë£¨</span>
    </div>
    <div class="tab-item" data-target="page-me">
      <span class="tab-icon">ğŸ‘¤</span>
      <span>ë‚´ ì •ë³´</span>
    </div>
  </nav>

  <script>
    // ============================================================
    //  ê¸°ì¡´ ë¡œì§ (ì§€ë„, ê¸¸ì°¾ê¸°, ì €ì¥) - ê±´ë“œë¦¬ì§€ ì•ŠìŒ
    // ============================================================
    const KAKAO_API_KEY = "c96c999113980d67c697b2f5a3d385f1"; 
    let map, ps, geocoder;
    let currentPolyline = null;
    let currentMarkers = [];
    let routeHistory = []; // ì €ì¥ëœ ì½”ìŠ¤ ë°ì´í„°
    let currentRouteData = null; // í˜„ì¬ ë³´ê³ ìˆëŠ” ê²½ë¡œ ì •ë³´

    function initMap() {
      const container = document.getElementById('map');
      const options = { center: new kakao.maps.LatLng(37.5665, 126.9780), level: 5 };
      map = new kakao.maps.Map(container, options);
      ps = new kakao.maps.services.Places();
      geocoder = new kakao.maps.services.Geocoder();
    }

    function clearMap() {
      if (currentPolyline) { currentPolyline.setMap(null); currentPolyline = null; }
      currentMarkers.forEach(mk => mk.setMap(null));
      currentMarkers = [];
    }

    // ê¸¸ì°¾ê¸° ë²„íŠ¼ í•¸ë“¤ëŸ¬
    async function handleSearchRoute() {
      const startVal = document.getElementById('start-input').value;
      const endVal = document.getElementById('end-input').value;
      const msgEl = document.getElementById('route-msg');
      
      if (!startVal) { alert("ì¶œë°œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
      
      msgEl.style.display = "block";
      msgEl.textContent = "ê²½ë¡œë¥¼ ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...";
      msgEl.className = "message";

      try {
        // 1. ì¶œë°œì§€ ì¢Œí‘œ ì°¾ê¸°
        const startCoord = await searchPlace(startVal);
        let endCoord = null;

        if (endVal) {
          // 2. ë„ì°©ì§€ ì¢Œí‘œ ì°¾ê¸°
          endCoord = await searchPlace(endVal);
        } else {
          // 3. ë„ì°©ì§€ ì—†ìœ¼ë©´ ë£¨í”„ ëª¨ë“œ ë¡œì§ (ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ ê·¼ì²˜ ì„ì˜ ì§€ì ìœ¼ë¡œ ì‹œë®¬ë ˆì´ì…˜)
          // ì‹¤ì œë¡œëŠ” ë³µì¡í•œ ì•Œê³ ë¦¬ì¦˜ì´ í•„ìš”í•˜ë‚˜, UI ë°ëª¨ìš©ìœ¼ë¡œ ì§ì„ ê±°ë¦¬ + @ ì²˜ë¦¬
          alert("ë„ì°©ì§€ê°€ ì—†ì–´ ì™•ë³µ ì½”ìŠ¤ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.");
          endCoord = startCoord; // ì¼ë‹¨ ì‹œì‘ì ìœ¼ë¡œ
        }

        // ì¹´ì¹´ì˜¤ ëª¨ë¹Œë¦¬í‹° API í˜¸ì¶œ ì‹œëŠ‰ (SDKë¡œëŠ” ì§ì ‘ ê²½ë¡œ ëª»ê·¸ë¦¼, ì§ì„ ë§Œ ê·¸ë¦¼)
        // ì‹¤ì œ êµ¬í˜„ ì‹œì—ëŠ” REST API í˜¸ì¶œ í•„ìš”. ì—¬ê¸°ì„œëŠ” ì‹œê°ì  ì˜ˆì‹œë¡œ ì§ì„  ì—°ê²°
        drawPath([startCoord, endCoord]);
        
        const dist = Math.round(getDistance(startCoord, endCoord) * 1.2); // ì‹¤ì œ ë„ë¡œ êµ´ê³¡ ê°ì•ˆ
        const time = Math.round(dist / 67); // ë¶„ (ì•½ 4km/h)

        msgEl.innerHTML = `ì˜ˆìƒ ê±°ë¦¬: <b>${(dist/1000).toFixed(2)}km</b> <br> ì˜ˆìƒ ì†Œìš”ì‹œê°„: <b>${time}ë¶„</b>`;
        
        // ì €ì¥í•  ë°ì´í„° ì¤€ë¹„
        currentRouteData = {
          id: Date.now(),
          title: `${startVal} -> ${endVal || 'ì™•ë³µ'}`,
          distance: dist, // meter
          date: new Date().toLocaleDateString()
        };
        document.getElementById('btn-save-route').disabled = false;

      } catch (err) {
        msgEl.textContent = "ì¥ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
        msgEl.className = "message error";
        console.error(err);
      }
    }

    // ëœë¤ ë£¨í”„ í•¸ë“¤ëŸ¬ (ê°„ì´)
    function handleLoopRoute() {
      // ê¸°ì¡´ ë¡œì§ ìœ ì§€ í˜¹ì€ í™•ì¥ ê°€ëŠ¥
      alert("ëœë¤ ë£¨í”„ ê¸°ëŠ¥: í˜„ì¬ ìœ„ì¹˜ ì£¼ë³€ì˜ ì¶”ì²œ ì½”ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. (êµ¬í˜„ ì˜ˆì‹œ)");
    }

    // ì¥ì†Œ ê²€ìƒ‰ Promise
    function searchPlace(keyword) {
      return new Promise((resolve, reject) => {
        ps.keywordSearch(keyword, (data, status) => {
          if (status === kakao.maps.services.Status.OK) {
            resolve({ lat: parseFloat(data[0].y), lng: parseFloat(data[0].x) });
          } else {
            reject("ê²€ìƒ‰ ì‹¤íŒ¨");
          }
        });
      });
    }

    // ì§€ë„ ê·¸ë¦¬ê¸°
    function drawPath(pathCoords) {
      clearMap();
      const linePath = pathCoords.map(c => new kakao.maps.LatLng(c.lat, c.lng));
      
      currentPolyline = new kakao.maps.Polyline({
        path: linePath, strokeWeight: 5, strokeColor: '#2563eb', strokeOpacity: 0.8, strokeStyle: 'solid'
      });
      currentPolyline.setMap(map);
      
      // ë§ˆì»¤
      pathCoords.forEach(c => {
        const mk = new kakao.maps.Marker({ position: new kakao.maps.LatLng(c.lat, c.lng) });
        mk.setMap(map);
        currentMarkers.push(mk);
      });

      // ë²”ìœ„ ì¬ì„¤ì •
      const bounds = new kakao.maps.LatLngBounds();
      linePath.forEach(p => bounds.extend(p));
      map.setBounds(bounds);
    }

    // ê±°ë¦¬ ê³„ì‚° (Haversine)
    function getDistance(c1, c2) {
      const R = 6371e3; 
      const Ï†1 = c1.lat * Math.PI/180, Ï†2 = c2.lat * Math.PI/180;
      const Î”Ï† = (c2.lat-c1.lat) * Math.PI/180, Î”Î» = (c2.lng-c1.lng) * Math.PI/180;
      const a = Math.sin(Î”Ï†/2)*Math.sin(Î”Ï†/2) + Math.cos(Ï†1)*Math.cos(Ï†2)*Math.sin(Î”Î»/2)*Math.sin(Î”Î»/2);
      return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    }

    // ì½”ìŠ¤ ì €ì¥
    function saveCurrentRoute() {
      if (!currentRouteData) return;
      routeHistory.push(currentRouteData);
      updateHistoryUI();
      
      // [NEW] í”„ë¡œí•„ í†µê³„ ì—…ë°ì´íŠ¸ í˜¸ì¶œ
      updateProfileStats(); 
      
      alert("ì½”ìŠ¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
      document.getElementById('btn-save-route').disabled = true;
    }

    function updateHistoryUI() {
      const list = document.getElementById('history-list');
      if (routeHistory.length === 0) return;
      
      list.innerHTML = "";
      routeHistory.forEach(item => {
        const li = document.createElement('li');
        li.style.marginBottom = "8px";
        li.innerHTML = `<strong>${item.title}</strong> <span style="font-size:0.8rem; color:#666;">(${(item.distance/1000).toFixed(1)}km)</span>`;
        list.appendChild(li);
      });
    }

    function resetStats() {
      if(confirm("ëª¨ë“  ê¸°ë¡ì„ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        routeHistory = [];
        updateHistoryUI();
        updateProfileStats();
        alert("ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
      }
    }

    // ============================================================
    //  [NEW] í”„ë¡œí•„ ë° ì°¨íŠ¸ ë¡œì§ (ì—¬ê¸°ê°€ ì¶”ê°€ëœ ë¶€ë¶„)
    // ============================================================
    let myChart = null;

    function initProfileChart() {
      const ctx = document.getElementById('activityChart').getContext('2d');
      
      myChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'],
          datasets: [{
            label: 'ëŸ¬ë‹ ê±°ë¦¬ (km)',
            data: [0, 0, 0, 0, 0, 0, 0], // ì´ˆê¸°ê°’ 0
            backgroundColor: 'rgba(37, 99, 235, 0.7)', // var(--primary)
            borderRadius: 5,
            barThickness: 15
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false } // ë²”ë¡€ ìˆ¨ê¹€
          },
          scales: {
            y: { beginAtZero: true, grid: { display: true, borderDash: [4, 4] } },
            x: { grid: { display: false } }
          }
        }
      });
    }

    function updateProfileStats() {
      // 1. í…ìŠ¤íŠ¸ í†µê³„ ê³„ì‚°
      const count = routeHistory.length;
      const totalMeters = routeHistory.reduce((acc, cur) => acc + cur.distance, 0);
      const totalKm = (totalMeters / 1000).toFixed(1);

      // 2. í™”ë©´ ì—…ë°ì´íŠ¸
      document.getElementById('profile-total-run').textContent = count;
      document.getElementById('profile-total-km').textContent = totalKm;
      document.getElementById('profile-saved-count').textContent = count;

      // 3. ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ë”ë¯¸ ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜)
      // ì‹¤ì œë¡œëŠ” ë‚ ì§œë³„ë¡œ ë°ì´í„°ë¥¼ ì§‘ê³„í•´ì•¼ í•˜ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” 
      // ë°©ê¸ˆ ì €ì¥í•œ ì½”ìŠ¤ ê±°ë¦¬ë¥¼ 'ì˜¤ëŠ˜(ì¼ìš”ì¼ì´ë¼ ê°€ì •)'ì´ë‚˜ ë§ˆì§€ë§‰ ë§‰ëŒ€ì— ë”í•˜ëŠ” ì‹ìœ¼ë¡œ ì—°ì¶œ
      if (myChart && count > 0) {
        const lastRunKm = routeHistory[routeHistory.length-1].distance / 1000;
        
        // ì˜ˆì‹œ: ì„ì˜ì˜ ìš”ì¼ì— ë°ì´í„° ì¶”ê°€ (ì‹œê°ì  íš¨ê³¼ìš©)
        // ì‹¤ì œ ì•±: new Date().getDay() ë“±ì„ ì‚¬ìš©í•´ í•´ë‹¹ ì¸ë±ìŠ¤ì— ë”í•¨
        const currentData = myChart.data.datasets[0].data;
        // ë§‰ëŒ€ ê·¸ë˜í”„ê°€ ì¡°ê¸ˆì”© ì°¨ì˜¤ë¥´ëŠ” íš¨ê³¼
        currentData[6] += lastRunKm; 
        
        myChart.update();
      } else if (myChart && count === 0) {
        // ì´ˆê¸°í™” ì‹œ
        myChart.data.datasets[0].data = [0,0,0,0,0,0,0];
        myChart.update();
      }
    }


    // ============================================================
    //  ì´ˆê¸°í™” ì‹¤í–‰
    // ============================================================
    document.addEventListener("DOMContentLoaded", function () {
      kakao.maps.load(function () {
        initMap();
      });

      // íƒ­ ì „í™˜ ë¡œì§
      const tabs = document.querySelectorAll('.tab-item');
      const pages = document.querySelectorAll('.page');

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // ëª¨ë“  íƒ­ ë¹„í™œì„±
          tabs.forEach(t => t.classList.remove('active'));
          pages.forEach(p => p.classList.remove('active'));

          // í´ë¦­í•œ íƒ­ í™œì„±
          tab.classList.add('active');
          const targetId = tab.dataset.target;
          document.getElementById(targetId).classList.add('active');
          
          // ë§Œì•½ ì§€ë„ í˜ì´ì§€ë¼ë©´ ì‚¬ì´ì¦ˆ ì¬ì¡°ì • (ê¹¨ì§ ë°©ì§€)
          if (targetId === 'page-home' && map) {
            setTimeout(() => map.relayout(), 0);
          }
        });
      });

      // ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
      document.getElementById('btn-search-route').addEventListener('click', handleSearchRoute);
      document.getElementById('btn-loop-route').addEventListener('click', handleLoopRoute);
      document.getElementById('btn-save-route').addEventListener('click', saveCurrentRoute);
      document.getElementById('btn-reset-stats').addEventListener('click', resetStats);

      // ê·¸ë£¹ ë°ëª¨ ë°ì´í„°
      const groupList = document.getElementById('group-list');
      groupList.innerHTML = `
        <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee;">
          <span>ğŸ¥‡ ìƒˆë²½ëŸ¬ë‹í´ëŸ½</span> <span style="color:blue; font-weight:bold;">1,204km</span>
        </div>
        <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee;">
          <span>ğŸ¥ˆ ì§ì¥ì¸ ë‹¬ë¦¬ê¸°</span> <span style="color:blue; font-weight:bold;">890km</span>
        </div>
        <div style="display:flex; justify-content:space-between; padding:10px;">
          <span>ğŸ¥‰ ë‹¤ì´ì–´íŠ¸ íŒŸ</span> <span style="color:blue; font-weight:bold;">450km</span>
        </div>
      `;

      // ì°¨íŠ¸ ì´ˆê¸°í™”
      initProfileChart();
      
      // ì°¨íŠ¸ì— ì´ˆê¸° ë”ë¯¸ ë°ì´í„° ì¢€ ë„£ì–´ë‘ê¸° (ì‹¬ì‹¬í•˜ë‹ˆê¹Œ)
      if(myChart) {
        myChart.data.datasets[0].data = [2, 0, 3.5, 1, 0, 5, 0];
        myChart.update();
      }
    });
  </script>
</body>
</html>