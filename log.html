<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>POKE RUN: ACCESS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:ital,wght@0,400;0,700;1,900&family=Inter:wght@400;700;900&family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. í…Œë§ˆ ì„¤ì • (White Mode Fixed) --- */
        :root { 
            --volt: #2563eb;         /* ì„ ëª…í•œ íŒŒë‘ (ê°•ì¡°ìƒ‰) */
            --bg-main: #f0f4f8;      /* ë°ì€ ë°°ê²½ */
            --bg-card: #ffffff;      /* í°ìƒ‰ ì¹´ë“œ */
            --text-main: #1a1a1a;    /* ê²€ì • í…ìŠ¤íŠ¸ */
            --border-color: #cccccc; /* ë°ì€ ê²½ê³„ì„  */
            --text-sub: #4b5563;     /* ì–´ë‘ìš´ ì„œë¸Œ í…ìŠ¤íŠ¸ */
        }
        
        /* --- 2. ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        body { 
            font-family: 'Inter', 'Noto Sans KR', sans-serif; 
            background-color: var(--bg-main); 
            color: var(--text-main); 
            overflow: hidden; 
            margin: 0; padding: 0;
        }
        .font-sport { font-family: 'Chakra Petch', sans-serif; }
        
        /* ëª¨ë‹¬ (íŒì—…ì°½) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); z-index: 50; display: none; 
            justify-content: center; align-items: center; padding: 20px; 
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-main);
            border-radius: 16px; width: 100%; max-width: 420px; max-height: 90vh; 
            overflow-y: auto; padding: 24px; position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
        .input-group { margin-bottom: 10px; position: relative; }
        .input-dark {
            width: 100%; background: var(--bg-main); /* ì‚´ì§ ì–´ë‘ìš´ ë°°ê²½ */
            border: 1px solid var(--border-color);
            color: var(--text-main);
            padding: 10px 12px; border-radius: 8px; outline: none; transition: 0.2s; font-size: 14px;
        }
        .input-dark:focus { border-color: var(--volt); background: #fff; }
        .input-error { border-color: #ef4444 !important; }
        .input-success { border-color: #22c55e !important; }

        /* ì¤‘ë³µí™•ì¸ ë²„íŠ¼ */
        .btn-check {
            position: absolute; right: 5px; top: 28px;
            background: var(--bg-card);
            color: var(--text-sub);
            padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer; border: 1px solid var(--border-color);
        }
        .btn-check:hover { background: var(--volt); color: white; border-color: var(--volt); }
        
        .msg-validate { font-size: 11px; margin-top: 2px; display: none; font-weight: bold; }
        
        /* íƒ­ ë²„íŠ¼ */
        .tab-btn { flex: 1; padding: 10px; text-align: center; cursor: pointer; border-bottom: 2px solid var(--border-color); color: var(--text-sub); }
        .tab-btn.active { border-color: var(--volt); color: var(--text-main); font-weight: bold; }

        /* ì°¾ê¸° ê²°ê³¼ ë°•ìŠ¤ */
        .find-result-box {
            background-color: var(--bg-main);
            color: var(--text-main);
            border: 1px solid var(--border-color);
        }

        /* ì…€ë ‰íŠ¸ ë°•ìŠ¤ í™”ì‚´í‘œ (ê²€ì€ìƒ‰) */
        select.input-dark { 
            appearance: none; 
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); 
            background-repeat: no-repeat; 
            background-position: right 0.5rem center; 
            background-size: 0.8em; 
            padding-right: 2rem;
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>

    <script type="module">
    // ----------------------------------------------------
    // (1) ì™¸ë¶€ ëª¨ë“ˆ import (ìƒˆë¡œ ë§Œë“  íŒŒì¼ì—ì„œ ê°€ì ¸ì˜´)
    // ----------------------------------------------------
    import { 
        auth, 
        isIdChecked, 
        isNickChecked,
        handleLoginLogic,
        checkDuplicateIDLogic,
        checkDuplicateNickLogic,
        handleSignupLogic,
        findIDLogic,
        findPWLogic
    } from "./firebase-service.js"; // ğŸ‘ˆ ê²½ë¡œ í™•ì¸ í•„ìˆ˜! (ê°™ì€ í´ë”ì— ìˆë‹¤ë©´ ./firebase-service.js)

    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // ----------------------------------------------------
    // (2) window í•¨ìˆ˜ ì¬ì •ì˜ (DOMì—ì„œ ë°ì´í„° ê°€ì ¸ì™€ ëª¨ë“ˆ í•¨ìˆ˜ í˜¸ì¶œ)
    // ----------------------------------------------------

    // --- ë¡œê·¸ì¸ ë¡œì§ ---
    window.handleLogin = async () => {
        const email = document.getElementById('login-email').value.trim();
        const pw = document.getElementById('login-pw').value;
        
        try {
            await handleLoginLogic(email, pw); // ğŸ‘ˆ ëª¨ë“ˆ í•¨ìˆ˜ í˜¸ì¶œ
        } catch(e) {
            alert("ë¡œê·¸ì¸ ì‹¤íŒ¨!\n" + e.message);
        }
    };

    // --- ìƒíƒœ ë³€í™” ê°ì§€ ---
    // ì´ ë¶€ë¶„ì€ auth ê°ì²´ë¥¼ import í–ˆìœ¼ë¯€ë¡œ ê·¸ëŒ€ë¡œ ìœ ì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
    onAuthStateChanged(auth, (user) => {
        if (user) {
            window.location.href = "index.html";
        } else {
            document.getElementById('login-screen').style.display = 'flex';
        }
    });

    // --- íšŒì›ê°€ì… ë° ì°¾ê¸° ê¸°ëŠ¥ ---
    window.checkDuplicateID = async () => {
        const idInput = document.getElementById('reg-custom-id');
        const val = idInput.value.trim();
        const msg = document.getElementById('msg-id');
        
        try {
            const { isAvailable, message } = await checkDuplicateIDLogic(val); // ğŸ‘ˆ ëª¨ë“ˆ í•¨ìˆ˜ í˜¸ì¶œ
            msg.style.display = 'block';
            msg.innerText = message;
            msg.style.color = isAvailable ? "#22c55e" : "#ef4444";
            // isIdCheckedëŠ” ëª¨ë“ˆ ë‚´ë¶€ì—ì„œ ì—…ë°ì´íŠ¸ë˜ì§€ë§Œ, í˜¹ì‹œ ëª¨ë¥¼ ìƒí™©ì— ëŒ€ë¹„í•˜ì—¬ 
            // ëª¨ë“ˆì—ì„œ ë°˜í™˜ëœ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ ë¡œì»¬ ë³€ìˆ˜ ì—…ë°ì´íŠ¸ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. (í˜„ì¬ ë¡œì§ì—ì„œëŠ” ëª¨ë“ˆ ë‚´ë¶€ì—ì„œ ì²˜ë¦¬)
        } catch(e) {
            alert(e.message);
            idInput.focus();
        }
    };

    window.checkDuplicateNick = async () => {
        const val = document.getElementById('reg-nick').value.trim();
        const msg = document.getElementById('msg-nick');
        
        try {
            const { isAvailable, message } = await checkDuplicateNickLogic(val); // ğŸ‘ˆ ëª¨ë“ˆ í•¨ìˆ˜ í˜¸ì¶œ
            msg.style.display = 'block';
            msg.innerText = message;
            msg.style.color = isAvailable ? "#22c55e" : "#ef4444";
        } catch(e) {
            alert(e.message);
        }
    };

    window.checkPwMatch = () => {
        const pw = document.getElementById('reg-pw').value;
        const pw2 = document.getElementById('reg-pw2').value;
        const msg = document.getElementById('msg-pw');
        if(pw2 === "") { msg.style.display = 'none'; return; }
        msg.style.display = 'block';
        if(pw === pw2) {
            msg.innerText = "ì¼ì¹˜í•©ë‹ˆë‹¤."; msg.style.color = "#22c55e";
        } else {
            msg.innerText = "ë¶ˆì¼ì¹˜í•©ë‹ˆë‹¤."; msg.style.color = "#ef4444";
        }
    };

    window.handleSignup = async () => {
        const email = document.getElementById('reg-email').value.trim();
        const customId = document.getElementById('reg-custom-id').value.trim();
        const nick = document.getElementById('reg-nick').value.trim();
        const pw = document.getElementById('reg-pw').value;
        const pw2 = document.getElementById('reg-pw2').value;
        const name = document.getElementById('reg-name').value;
        const phone = document.getElementById('reg-phone').value;
        const y = document.getElementById('reg-year').value;
        const m = document.getElementById('reg-month').value;
        const d = document.getElementById('reg-day').value;
        const dob = `${y}-${m}-${d}`;
        
        if(pw !== pw2) return alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜."); // ë¡œì»¬ ìœ íš¨ì„± ê²€ì‚¬

        try {
            await handleSignupLogic(email, customId, nick, pw, name, phone, dob); // ğŸ‘ˆ ëª¨ë“ˆ í•¨ìˆ˜ í˜¸ì¶œ
            alert("ê°€ì… ì™„ë£Œ! ìë™ ë¡œê·¸ì¸ë©ë‹ˆë‹¤.");
            closeModal('modal-signup');
        } catch(e) {
            alert("ê°€ì… ì˜¤ë¥˜: " + e.message);
        }
    };

    window.findID = async () => {
        const email = document.getElementById('find-id-email').value.trim();
        const resultBox = document.getElementById('find-result-text-id');
        
        resultBox.innerHTML = "í™•ì¸ ì¤‘...";

        try {
            const userId = await findIDLogic(email); // ğŸ‘ˆ ëª¨ë“ˆ í•¨ìˆ˜ í˜¸ì¶œ
            
            if(userId) {
                resultBox.innerHTML = `
                    <div class="text-center">
                        <p class="text-sm text-gray-500 mb-2">íšŒì›ë‹˜ì˜ ì•„ì´ë””ëŠ”</p>
                        <b class="text-[var(--volt)] text-2xl block mb-6">${userId}</b>
                        <button onclick="closeModal('modal-find')" class="w-full bg-[var(--volt)] text-white font-bold py-3 rounded-xl hover:opacity-80 transition-colors">
                            ë¡œê·¸ì¸ í•˜ëŸ¬ ê°€ê¸°
                        </button>
                    </div>
                `;
            } else {
                resultBox.innerHTML = `<span style="color:#ef4444">ê°€ì…ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</span>`;
            }
        } catch(e) {
            alert("ì˜¤ë¥˜: " + e.message);
            resultBox.innerHTML = `<span style="color:#ef4444">${e.message}</span>`;
        }
    };

    window.findPW = async () => {
        const targetId = document.getElementById('find-pw-id').value.trim();
        const targetEmail = document.getElementById('find-pw-email').value.trim();
        const resultBox = document.getElementById('find-result-text-pw');

        resultBox.innerHTML = "í™•ì¸ ì¤‘...";

        try {
            const password = await findPWLogic(targetId, targetEmail); // ğŸ‘ˆ ëª¨ë“ˆ í•¨ìˆ˜ í˜¸ì¶œ
            
            if(password) {
                 resultBox.innerHTML = `
                    <div class="text-center">
                        <p class="text-sm text-gray-500 mb-2">íšŒì›ë‹˜ì˜ ë¹„ë°€ë²ˆí˜¸ëŠ”</p>
                        <b class="text-[var(--volt)] text-2xl block mb-6">${password}</b>
                        <button onclick="closeModal('modal-find')" class="w-full bg-[var(--volt)] text-white font-bold py-3 rounded-xl hover:opacity-80 transition-colors">
                            ë¡œê·¸ì¸ í•˜ëŸ¬ ê°€ê¸°
                        </button>
                    </div>
                `;
            } else {
                 resultBox.innerHTML = `<span style="color:#ef4444">ë¹„ë°€ë²ˆí˜¸ ì •ë³´ ì—†ìŒ.</span>`;
            }
        } catch(e) {
            alert("ì˜¤ë¥˜: " + e.message);
            resultBox.innerHTML = `<span style="color:#ef4444">${e.message}</span>`;
        }
    };

    // --- ê¸°íƒ€ UI í•¨ìˆ˜ (ê·¸ëŒ€ë¡œ ìœ ì§€) ---
    window.openModal = (id) => document.getElementById(id).style.display = 'flex';
    window.closeModal = (id) => document.getElementById(id).style.display = 'none';
    window.switchTab = (tab) => {
        document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(`tab-${tab}`).style.display = 'block';
        document.getElementById(`btn-${tab}`).classList.add('active');
    }

    window.onload = () => {
        const y = document.getElementById('reg-year');
        const m = document.getElementById('reg-month');
        const d = document.getElementById('reg-day');
        const curr = new Date().getFullYear();
        for(let i=curr; i>=1950; i--) y.add(new Option(i+'ë…„', i));
        for(let i=1; i<=12; i++) m.add(new Option(i+'ì›”', i));
        for(let i=1; i<=31; i++) d.add(new Option(i+'ì¼', i));
    }
</script>
</head>
<body class="flex justify-center h-screen w-full bg-[var(--bg-main)] text-[var(--text-main)]">

    <div class="w-full max-w-md h-full relative overflow-hidden bg-[var(--bg-main)] shadow-2xl">
        <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1516724562728-afc824a36e84?q=80&w=1000')] bg-cover bg-center opacity-10"></div>
        <div class="absolute inset-0 bg-gradient-to-b from-white/20 via-white/80 to-[#f0f4f8]"></div>

        <div id="login-screen" class="relative z-10 w-full h-full flex flex-col items-center justify-center p-6 text-center">
            <h1 class="text-5xl font-sport font-black italic tracking-tighter text-[var(--text-main)] mb-2">
                POKE<span class="text-[var(--volt)]">RUN</span>
            </h1>
            <p class="text-[var(--text-sub)] mb-10 text-sm">Run, Battle, and Socialize.</p>

            <div class="w-full space-y-3">
                <input type="email" id="login-email" class="input-dark" placeholder="ì´ë©”ì¼">
                <input type="password" id="login-pw" class="input-dark" placeholder="ë¹„ë°€ë²ˆí˜¸">
                
                <button onclick="handleLogin()" class="w-full bg-[var(--volt)] text-white font-bold py-3.5 rounded-xl hover:opacity-90 transition-opacity mt-2 shadow-md">
                    ë¡œê·¸ì¸
                </button>

                <div class="flex justify-between text-xs text-[var(--text-sub)] px-1 mt-2">
                    <button onclick="openModal('modal-find'); switchTab('id');" class="hover:text-[var(--text-main)]">ì•„ì´ë””/ë¹„ë²ˆ ì°¾ê¸°</button>
                    <button onclick="openModal('modal-signup')" class="hover:text-[var(--volt)] font-bold">íšŒì›ê°€ì…</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-signup" class="modal-overlay">
        <div class="modal-content scrollbar-hide">
            <div class="flex justify-between items-center mb-6 border-b border-[var(--border-color)] pb-2">
                <h2 class="text-xl font-bold">íšŒì›ê°€ì…</h2>
                <button onclick="closeModal('modal-signup')" class="text-[var(--text-sub)] text-xl">âœ•</button>
            </div>
            
            <div class="space-y-2">
                <div class="input-group">
                    <label class="text-xs text-[var(--text-sub)] block mb-1">ì´ë©”ì¼ (ë¡œê·¸ì¸ìš©)</label>
                    <input type="email" id="reg-email" class="input-dark" placeholder="example@email.com">
                </div>
                
                <div class="input-group">
                    <label class="text-xs text-[var(--text-sub)] block mb-1">ì•„ì´ë””</label>
                    <input type="text" id="reg-custom-id" class="input-dark" placeholder="4ì ì´ìƒ">
                    <button class="btn-check" onclick="checkDuplicateID()">ì¤‘ë³µí™•ì¸</button>
                    <p id="msg-id" class="msg-validate"></p>
                </div>

                <div class="input-group">
                    <label class="text-xs text-[var(--text-sub)] block mb-1">ë‹‰ë„¤ì„</label>
                    <input type="text" id="reg-nick" class="input-dark" placeholder="2ì ì´ìƒ">
                    <button class="btn-check" onclick="checkDuplicateNick()">ì¤‘ë³µí™•ì¸</button>
                    <p id="msg-nick" class="msg-validate"></p>
                </div>

                <div class="input-group">
                    <label class="text-xs text-[var(--text-sub)] block mb-1">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="reg-pw" class="input-dark" placeholder="6ìë¦¬ ì´ìƒ" oninput="checkPwMatch()">
                </div>

                <div class="input-group">
                    <label class="text-xs text-[var(--text-sub)] block mb-1">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input type="password" id="reg-pw2" class="input-dark" placeholder="ì¬ì…ë ¥" oninput="checkPwMatch()">
                    <p id="msg-pw" class="msg-validate"></p>
                </div>

                <div class="input-group">
                    <label class="text-xs text-[var(--text-sub)] block mb-1">ìƒë…„ì›”ì¼</label>
                    <div class="flex gap-2">
                        <select id="reg-year" class="input-dark w-full"></select>
                        <select id="reg-month" class="input-dark w-full"></select>
                        <select id="reg-day" class="input-dark w-full"></select>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <div class="input-group">
                        <label class="text-xs text-[var(--text-sub)] block mb-1">ì´ë¦„</label>
                        <input type="text" id="reg-name" class="input-dark">
                    </div>
                    <div class="input-group">
                        <label class="text-xs text-[var(--text-sub)] block mb-1">ì „í™”ë²ˆí˜¸</label>
                        <input type="text" id="reg-phone" class="input-dark">
                    </div>
                </div>

                <button onclick="handleSignup()" class="w-full bg-[var(--volt)] text-white font-bold py-3 rounded-xl mt-2 shadow-md">ê°€ì… ì™„ë£Œ</button>
            </div>
        </div>
    </div>

    <div id="modal-find" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">ê³„ì • ì°¾ê¸°</h2>
                <button onclick="closeModal('modal-find')" class="text-[var(--text-sub)] text-xl">âœ•</button>
            </div>

            <div class="flex mb-4">
                <div id="btn-id" class="tab-btn active" onclick="switchTab('id')">ì•„ì´ë”” ì°¾ê¸°</div>
                <div id="btn-pw" class="tab-btn" onclick="switchTab('pw')">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</div>
            </div>

            <div id="tab-id" class="tab-content">
                <p class="text-xs text-[var(--text-sub)] mb-2">ê°€ì… ì´ë©”ì¼</p>
                <input type="email" id="find-id-email" class="input-dark mb-3" placeholder="email@example.com">
                <button onclick="findID()" class="w-full bg-[var(--volt)] text-white font-bold py-3 rounded-xl shadow-md">í™•ì¸</button>
                <div id="find-result-text-id" class="mt-4 text-center text-sm border border-[var(--border-color)] p-3 rounded-lg find-result-box">
                    ê²°ê³¼ í‘œì‹œ
                </div>
            </div>

            <div id="tab-pw" class="tab-content" style="display:none;">
                <p class="text-xs text-[var(--text-sub)] mb-2">ì•„ì´ë”” & ì´ë©”ì¼</p>
                <input type="text" id="find-pw-id" class="input-dark mb-2" placeholder="ì•„ì´ë””">
                <input type="email" id="find-pw-email" class="input-dark mb-3" placeholder="ì´ë©”ì¼">
                <button onclick="findPW()" class="w-full bg-[var(--volt)] text-white font-bold py-3 rounded-xl shadow-md">í™•ì¸</button>
                <div id="find-result-text-pw" class="mt-4 text-center text-sm border border-[var(--border-color)] p-3 rounded-lg find-result-box">
                    ê²°ê³¼ í‘œì‹œ
                </div>
            </div>
        </div>
    </div>

</body>
</html>