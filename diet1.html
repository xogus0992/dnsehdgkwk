<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c96c999113980d67c697b2f5a3d385f1&libraries=services"></script>
<title>ë‹¤ì´ì–´íŠ¸ ë‚´ë¹„ê²Œì´ì…˜ (v3.5)</title>
<style>
    /* v2.6: ë””ìì¸ ëŒ€ëŒ€ì  ê°œí¸ (í™œê¸°ì°¬ ê±·ê¸° ì•± í…Œë§ˆ) */
    html, body {
        width: 100%; height: 100%; margin: 0; padding: 0;
        /* v2.6: í°íŠ¸ ë³€ê²½ ë° ë°°ê²½ìƒ‰ ë³€ê²½ */
        font-family: 'Noto Sans KR', sans-serif;
        background-color: #F7FAFC; /* ì‚­ë§‰í•œ íšŒìƒ‰ -> ì‚°ëœ»í•œ í•˜ëŠ˜ìƒ‰ */
        /* v3.3: í•˜ë‹¨ íƒ­ ë°” ê³µê°„ í™•ë³´ */
        padding-bottom: 70px;
    }
    .main-container { 
        width: 100%; max-width: 800px; margin: 20px auto; 
        padding: 12px; /* ëª¨ë°”ì¼ ëŒ€ì‘ íŒ¨ë”© */
        box-sizing: border-box; 
    }
    .map-wrapper { position: relative; width: 100%; }
    #map { 
        width: 100%; height: 500px; 
        border-radius: 16px; /* v2.6: ë” ë¶€ë“œëŸ¬ìš´ ëª¨ì„œë¦¬ */
        box-shadow: 0 8px 16px rgba(0,0,0,0.1); /* v2.6: ë” ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
        background-color: #e9e9e9; 
    }
    
    /* v2.6: ë©”ì¸ ì •ë³´ íŒ¨ë„ (í°ìƒ‰ ì¹´ë“œ ìŠ¤íƒ€ì¼) */
    .info-panel { 
        width: 100%; 
        padding: 24px; /* v2.6: íŒ¨ë”© ì¦ê°€ */
        background-color: white; 
        margin-top: 24px; /* v2.6: ê°„ê²© ì¦ê°€ */
        box-shadow: 0 4px 12px rgba(0,0,0,0.05); /* v2.6: ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
        box-sizing: border-box; 
        border-radius: 16px; /* v2.6: ë¶€ë“œëŸ¬ìš´ ëª¨ì„œë¦¬ */
    }
    
    /* v2.6: íŒ¨ë„ ì œëª© (í™œê¸°ì°¬ ìŠ¤íƒ€ì¼) */
    .info-panel h2 { 
        margin: 0 0 24px 0; 
        font-size: 1.8em; 
        font-weight: 700; /* Bold */
        color: #222;
        text-align: center; 
        display: flex; align-items: center; justify-content: center;
        gap: 10px; /* ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ê°„ê²© */
    }
    /* v2.6: ì œëª© ì•„ì´ì½˜ ê·¸ë¼ë°ì´ì…˜ */
    .info-panel h2 .icon-gradient {
        display: inline-block;
        font-size: 1.2em;
        background: linear-gradient(135deg, #3B82F6, #10B981); /* íŒŒë‘-ì´ˆë¡ */
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-fill-color: transparent;
    }

    .input-group { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: center; }
    .input-wrapper { display: flex; flex-grow: 1; position: relative; min-width: 150px; }
    
    /* v2.8: 'ë‚´ ìœ„ì¹˜' ë²„íŠ¼ ë„˜ì¹¨ ë¬¸ì œ ìˆ˜ì • (width: 100% -> flex-grow: 1) */
    #navPanel input[type="text"] { 
        /* width: 100%; */ /* v2.8: ì‚­ì œ */
        flex-grow: 1; /* v2.8: ì¶”ê°€ (ë‚¨ì€ ê³µê°„ ëª¨ë‘ ì°¨ì§€) */
        min-width: 50px; /* v2.8: ì¶”ê°€ (ìµœì†Œ ë„ˆë¹„ ë³´ì¥) */
        padding: 12px 16px; border: 1px solid #ccc; 
        border-radius: 8px 0 0 8px; 
        font-size: 1em; box-sizing: border-box; border-right: none;
        height: 48px; /* ë²„íŠ¼ê³¼ ë†’ì´ í†µì¼ */
    }
    #navPanel .input-wrapper.end input[type="text"] { 
        border-radius: 8px; border-right: 1px solid #ccc; height: 48px;
        /* v2.8: .end í´ë˜ìŠ¤ëŠ” flex-growê°€ ì´ë¯¸ 1ì´ë¯€ë¡œ(input-wrapperì— ìˆìŒ) input ìˆ˜ì • ë¶ˆí•„ìš” */
    }
    #navPanel .input-wrapper.target { 
        border: 1px solid #ccc; border-radius: 8px; 
        display: flex; align-items: center; height: 48px;
    }
    #navPanel .input-wrapper.target .icon { padding-left: 12px; }
    #navPanel .input-wrapper.target .unit { padding-right: 12px; color: #888; font-weight: bold; }
    #navPanel .input-wrapper.target input[type="number"] { border: none; text-align: center; background: none; outline: none; padding: 12px 0; width: 100%; flex-grow: 1; }
    
    #calculated-calories, #weight-loss-result { font-size: 0.9em; font-weight: 500; flex-shrink: 0; }
    #calculated-calories { color: #333; }
    #weight-loss-result { color: #0EA5E9; margin-left: 5px; } /* v2.6: ìƒ‰ìƒ ë³€ê²½ (Light Blue) */
    
    /* v2.6: ëª¨ë“  ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ (í™œê¸°ì°¨ê²Œ) */
    #searchBtn, #openModalBtn, #myLocationBtn, .general-btn {
        padding: 12px 20px;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        font-weight: 500; /* Noto Sans 500 */
        cursor: pointer;
        height: 48px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    #searchBtn:hover, #openModalBtn:hover, #myLocationBtn:hover:not(:disabled), .general-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    
    /* v2.6: ë²„íŠ¼ë³„ ê·¸ë¼ë°ì´ì…˜ ì ìš© */
    #searchBtn { /* ì½”ìŠ¤ ìƒì„± (ì´ˆë¡) */
        background: linear-gradient(135deg, #22C55E, #10B981);
        flex-grow: 1; /* ë‚¨ëŠ” ê³µê°„ ì°¨ì§€ */
    }
    #openModalBtn { /* ë‚´ ì •ë³´ (íŒŒë‘) */
        background: linear-gradient(135deg, #3B82F6, #0EA5E9);
    }
    #myLocationBtn { /* ë‚´ ìœ„ì¹˜ (íšŒìƒ‰) */
        background: #64748B;
        border-radius: 0 8px 8px 0;
        border: 1px solid #64748B; border-left: none;
        flex-shrink: 0; /* v2.8: ì¶”ê°€ (ë²„íŠ¼ì´ ì°Œê·¸ëŸ¬ì§€ì§€ ì•Šë„ë¡ ê³ ì •) */
    }
    #myLocationBtn:disabled {
        background-color: #aaa;
        cursor: not-allowed;
        transform: none;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    /* v3.4: 'ë‚˜' í˜ì´ì§€ ë²„íŠ¼ë“¤ */
    #page-me .general-btn { width: 100%; margin-bottom: 10px; }
    #btnCheckAttendance { background-color: #10B981; } /* ì¶œì„ */
    #btnCheckAttendance:disabled { background-color: #aaa; }

    #result-area { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; text-align: left; }
    
    /* v2.6: ì½”ìŠ¤ ì¹´ë“œ (í°ìƒ‰ ë°°ê²½, ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì) */
    .route-card { 
        border: 2px solid #E5E7EB; /* ì—°í•œ íšŒìƒ‰ í…Œë‘ë¦¬ */
        border-radius: 12px;
        padding: 20px;
        flex-basis: 320px; 
        background-color: #FFFFFF; /* ì‚­ë§‰í•œ íšŒìƒ‰ -> í°ìƒ‰ */
        flex-grow: 1; cursor: pointer; 
        transition: border-color 0.2s, box-shadow 0.2s, transform 0.2s;
        /* v3.4: ì¹´ë“œ ì €ì¥ ë²„íŠ¼ì„ ìœ„í•œ position */
        position: relative;
    }
    .route-card:hover { 
        transform: translateY(-4px);
        box-shadow: 0 6px 16px rgba(0,0,0,0.07); 
    }
    /* v2.6: ì„ íƒëœ ì¹´ë“œ (í…Œë§ˆìƒ‰ ê·¸ë¦¼ì) */
    .route-card.selected { 
        border-width: 2px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.12); 
    }
    .route-card.optimal.selected { 
        border-color: #3B82F6; /* íŒŒë‘ */
        box-shadow: 0 8px 20px rgba(59, 130, 246, 0.2); 
    } 
    .route-card.scenic.selected { 
        border-color: #10B981; /* ì´ˆë¡ */
        box-shadow: 0 8px 20px rgba(16, 185, 129, 0.2);
    } 
    .route-card.round-trip.selected { 
        border-color: #0EA5E9; /* í•˜ëŠ˜ */
        box-shadow: 0 8px 20px rgba(14, 165, 233, 0.2);
    }

    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .card-header h3 { margin: 0; flex-grow: 1; font-weight: 700; }
    .card-refresh-btn {
        padding: 5px; border: none; background: none; font-size: 1.2em; cursor: pointer;
        border-radius: 50%; width: 30px; height: 30px; line-height: 20px; text-align: center;
    }
    .card-refresh-btn:hover { background-color: #e9e9e9; }
    .card-refresh-btn.hidden { display: none; }
    .card-loading { display: none; }
    
    /* v3.4: ì½”ìŠ¤ ì €ì¥ ë²„íŠ¼ */
    .card-save-btn {
        position: absolute;
        bottom: 15px;
        right: 15px;
        background: #64748B;
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.2em;
        line-height: 40px;
        text-align: center;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        transition: transform 0.2s;
    }
    .card-save-btn:hover {
        transform: scale(1.1);
    }

    .suggestions-list { display: none; position: absolute; top: 100%; left: 0; right: 0; background-color: white; border: 1px solid #ddd; z-index: 1001; max-height: 220px; overflow-y: auto; border-radius: 0 0 8px 8px; }
    .suggestion-item { padding: 12px 15px; cursor: pointer; }
    .suggestion-item:hover { background-color: #f5f5f5; }
    .version-tag { display: inline-block; font-size: 0.6em; font-weight: bold; color: #fff; background-color: #6c757d; padding: 4px 8px; border-radius: 10px; vertical-align: middle; margin-left: 10px; }
    
    /* ëª¨ë‹¬ CSS (ë‹¤ì´ì–´íŠ¸ ì •ë³´ ëª¨ë‹¬ë§Œ ë‚¨ê¹€) */
    .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
    .modal-content { position: relative; background: white; padding: 30px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); width: 90%; text-align: center; }
    .close-button { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; z-index: 10; }
    #dietInfoModal .modal-content { max-width: 480px; }
    #dietInfoModal h2 { font-size: 1.8em; margin-bottom: 25px; color: #2c3e50; font-weight: 700; }
    .modal-input-group { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
    .modal-input-group label { font-size: 1.1em; width: 24px; text-align: center; color: #555; }
    .modal-input-group input, .modal-input-group select { flex-grow: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1em; background-color: #f9f9f9; }
    .modal-input-grid { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 20px; }
    .modal-input-grid > .modal-input-group { flex-basis: calc(50% - 6px); flex-grow: 1; }
    #saveInfoBtn { /* v2.6: ê·¸ë¼ë°ì´ì…˜ ë²„íŠ¼ */
        width: 100%; padding: 15px; font-size: 1.1em; font-weight: 500; 
        color: white; background: linear-gradient(135deg, #3B82F6, #0EA5E9); 
        border: none; border-radius: 8px; cursor: pointer; 
        transition: transform 0.2s ease, box-shadow 0.2s ease; margin-top: 10px; 
    }
    #saveInfoBtn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
    #character-display { margin: 25px auto; width: 120px; height: 180px; display: flex; justify-content: center; align-items: center; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #eee; }
    #characterImage { max-width: 100%; max-height: 100%; object-fit: contain; }
    #goal-progress { margin-top: 20px; }
    .progress-bar-container { width: 100%; background-color: #ddd; border-radius: 10px; height: 25px; overflow: hidden; display: flex; }
    #bar-achieved, #bar-excess { height: 100%; transition: width 0.5s ease; }
    #bar-achieved { background-color: #4caf50;} #bar-excess { background-color: #e61a5f; }
    #progress-text, #result-display p { font-weight: 500; }
    #result-display { margin-top: 20px; text-align: left; background: #f8f9fa; padding: 15px; border-radius: 8px;}
    
    /* ========== v3.4: íƒ­ UI ìŠ¤íƒ€ì¼ ========== */
    .page-content {
        width: 100%;
    }

    #bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        height: 60px; /* íƒ­ ë°” ë†’ì´ */
        background-color: #ffffff;
        border-top: 1px solid #e0e0e0;
        display: flex;
        z-index: 1000;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }
    .nav-btn {
        flex: 1; /* 1:1 ë¹„ìœ¨ (v3.4: 4ê°œ íƒ­) */
        display: flex;
        flex-direction: column; /* ì•„ì´ì½˜/í…ìŠ¤íŠ¸ ì„¸ë¡œ ì •ë ¬ */
        justify-content: center;
        align-items: center;
        border: none;
        background: none;
        cursor: pointer;
        font-size: 0.8em;
        font-weight: 500;
        color: #888;
        padding: 5px 0;
        transition: color 0.2s;
    }
    .nav-btn span {
        font-size: 1.4em; /* ì•„ì´ì½˜ í¬ê¸° */
        margin-bottom: 2px;
    }
    .nav-btn:hover {
        color: #333;
    }
    .nav-btn.active {
        /* í™œì„± íƒ­ (íŒŒë€ìƒ‰) */
        color: #3B82F6; 
    }

    /* v3.4: 'ê¸°ë¡' (History) í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
    .history-card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        margin-bottom: 20px;
        overflow: hidden;
    }
    .history-card img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        background-color: #f0f0f0;
        border-bottom: 1px solid #eee;
    }
    .history-card-content {
        padding: 20px;
    }
    .history-card-content h3 {
        margin: 0 0 10px 0;
        font-size: 1.2em;
    }
    .history-card-content p {
        margin: 5px 0;
        font-size: 0.95em;
        color: #555;
    }
    .history-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 99px;
        font-size: 0.8em;
        font-weight: bold;
        color: white;
    }
    .history-badge.optimal { background-color: #3B82F6; }
    .history-badge.round-trip { background-color: #0EA5E9; }
    .history-badge.scenic { background-color: #10B981; }

    /* v3.4: 'ê·¸ë£¹' í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
    .group-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    .group-list-item {
        display: flex;
        align-items: center;
        padding: 15px;
        border-bottom: 1px solid #f0f0f0;
    }
    .group-list-item:last-child { border-bottom: none; }
    .group-list-item img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        margin-right: 15px;
        object-fit: cover;
        background-color: #eee;
    }
    .group-list-item .info {
        flex-grow: 1;
    }
    .group-list-item .info strong {
        font-size: 1.1em;
        color: #333;
    }
    .group-list-item .info span {
        font-size: 0.9em;
        color: #777;
    }
    .group-list-item .rank {
        font-size: 1.2em;
        font-weight: bold;
        color: #555;
    }

    /* v3.4: 'ë‚˜' í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
    .my-page-stats {
        display: flex;
        gap: 15px;
        margin-bottom: 25px;
    }
    .stat-box {
        flex: 1;
        background: #F7FAFC;
        border: 1px solid #E5E7EB;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
    }
    .stat-box .label {
        font-size: 0.9em;
        color: #666;
        margin-bottom: 8px;
    }
    .stat-box .value {
        font-size: 1.5em;
        font-weight: 700;
        color: #3B82F6;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
        margin-bottom: 20px;
    }
    .calendar-day {
        width: 100%;
        padding-bottom: 100%; /* ì •ì‚¬ê°í˜• ë¹„ìœ¨ */
        position: relative;
        background: #f0f0f0;
        border-radius: 8px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 0.8em;
        font-weight: 500;
        color: #aaa;
    }
    .calendar-day span {
        position: absolute;
    }
    .calendar-day.checked {
        background: #10B981;
        color: white;
        font-weight: bold;
    }
</style>
</head>
<body>

<div id="page-home" class="page-content" style="display: block;">
    <div class="main-container">
        <div class="map-wrapper">
            <div id="map"></div>
            </div>

        <div id="navPanel" class="info-panel">
            <h2><span class="icon-gradient">ğŸ—ºï¸</span> ê²½ë¡œ ê²€ìƒ‰</h2>
            <div class="input-group">
                <div class="input-wrapper">
                    <input type="text" id="start-input" placeholder="ì¶œë°œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì„œìš¸ì—­)">
                    <div class="suggestions-list" id="start-suggestions"></div>
                </div>
                <button id="myLocationBtn">ë‚´ ìœ„ì¹˜</button>
            </div>
            <div class="input-group">
                <div class="input-wrapper end">
                    <input type="text" id="end-input" placeholder="ë„ì°©ì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ë‚¨ì‚°íƒ€ì›Œ)">
                    <div class="suggestions-list" id="end-suggestions"></div>
                </div>
                <button id="openModalBtn">ë‚´ ì •ë³´</button>
            </div>

            <div class="input-group">
                <div class="input-wrapper target">
                    <div class="icon">ğŸš¶</div>
                    <input type="number" id="targetDistance" value="5" placeholder="ëª©í‘œ ê±°ë¦¬(km)" min="1" max="50">
                    <div class="unit">km</div>
                </div>
                <div id="calculated-calories">0 kcal ì†Œëª¨</div>
                <div id="weight-loss-result">(0g ê°ëŸ‰)</div>
            </div>
            
            <button id="searchBtn">ì½”ìŠ¤ ìƒì„±</button>

            <div id="result-area" style="margin-top: 25px;">
                <p id="map-notice" style="text-align: center; color: #666;">ì¶œë°œì§€ì™€ ë„ì°©ì§€ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ëª©í‘œ ê±°ë¦¬ë¥¼ ì„¤ì •í•˜ê³  ì½”ìŠ¤ ìƒì„± ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
                </div>
        </div>
        
    </div>
</div>

<div id="page-history" class="page-content" style="display: none;">
    <div class="main-container">
        <div class="info-panel">
            <h2><span class="icon-gradient">ğŸ“š</span>ë‚˜ì˜ ê±·ê¸° ê¸°ë¡</h2>
            <div id="page-history-content">
                <p>ì•„ì§ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. í™ˆì—ì„œ ì½”ìŠ¤ë¥¼ ê²€ìƒ‰í•˜ê³  [ğŸ’¾ ì €ì¥] ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.</p>
            </div>
        </div>
    </div>
</div>

<div id="page-group" class="page-content" style="display: none;">
    <div class="main-container">
        <div class="info-panel">
            <h2><span class="icon-gradient">ğŸ‘¥</span>ê·¸ë£¹ ë­í‚¹</h2>
            <div id="page-group-content">
            </div>
        </div>
    </div>
</div>

<div id="page-me" class="page-content" style="display: none;">
    <div class="main-container">
        <div class="info-panel">
            <h2><span class="icon-gradient">ğŸ‘¤</span>ë§ˆì´ í˜ì´ì§€</h2>
            <div class="my-page-stats">
                <div class="stat-box">
                    <div class="label">ì´ ê±¸ì€ ê±°ë¦¬</div>
                    <div class="value" id="total-walked-dist">0 km</div>
                </div>
                <div class="stat-box">
                    <div class="label">ì´ ì¶œì„ì¼</div>
                    <div class="value" id="total-attendance-days">0 ì¼</div>
                </div>
            </div>
            <div id="page-me-content-attendance">
                <h3>ì¶œì„ ìŠ¤íƒ¬í”„</h3>
                <div id="calendar-grid" class="calendar-grid">
                </div>
                <button id="btnCheckAttendance" class="general-btn">ì˜¤ëŠ˜ ì¶œì„ì²´í¬</button>
            </div>
            <div id="page-me-content-info" style="margin-top: 30px;">
                <h3>ë‹¤ì´ì–´íŠ¸ ëª©í‘œ</h3>
                <div id="character-display"><img id="characterImage" src="https://i.imgur.com/ecc7NYi.png" alt="ìºë¦­í„° ì´ë¯¸ì§€"></div>
                <div id="result-display">
                    <p id="info-current-weight"></p>
                    <p id="info-target-weight"></p>
                </div>
                <div id="goal-progress" style="margin-top: 15px;">
                    <p id="progress-text"></p>
                    <div class="progress-bar-container">
                        <div id="bar-achieved"></div>
                        <div id="bar-excess"></div>
                    </div>
                </div>
                <button id="openModalBtn" class="general-btn">ë‚´ ì •ë³´ ìˆ˜ì •</button>
            </div>
        </div>
    </div>
</div>

<div id="dietInfoModal" class="modal">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2>ë‚´ ë‹¤ì´ì–´íŠ¸ ì •ë³´ ì…ë ¥</h2>
        <div class="modal-input-grid">
            <div class="modal-input-group">
                <label>ğŸ‘¤</label>
                <select id="gender-select">
                    <option value="male">ë‚¨ì„±</option>
                    <option value="female">ì—¬ì„±</option>
                </select>
            </div>
            <div class="modal-input-group">
                <label>ğŸ“</label>
                <input type="number" id="height-input" placeholder="í‚¤ (cm)" value="170" min="100" max="250">
            </div>
            <div class="modal-input-group">
                <label>âš–ï¸</label>
                <input type="number" id="current-weight-input" placeholder="í˜„ì¬ ì²´ì¤‘ (kg)" value="70" min="30" max="300">
            </div>
            <div class="modal-input-group">
                <label>ğŸ¯</label>
                <input type="number" id="target-weight-input" placeholder="ëª©í‘œ ì²´ì¤‘ (kg)" value="65" min="30" max="300">
            </div>
        </div>
        <div class="modal-input-group">
            <label>ğŸ“…</label>
            <input type="date" id="goal-date-input" placeholder="ëª©í‘œ ë‹¬ì„±ì¼">
        </div>
        <button id="saveInfoBtn">ì •ë³´ ì €ì¥ ë° ëª©í‘œ ì„¤ì •</button>
    </div>
</div>

<nav id="bottom-nav">
    <button class="nav-btn active" id="nav-btn-home">
        <span class="material-symbols-outlined">directions_run</span>
        í™ˆ
    </button>
    <button class="nav-btn" id="nav-btn-history">
        <span class="material-symbols-outlined">history_edu</span>
        ê¸°ë¡
    </button>
    <button class="nav-btn" id="nav-btn-group">
        <span class="material-symbols-outlined">group</span>
        ê·¸ë£¹
    </button>
    <button class="nav-btn" id="nav-btn-me">
        <span class="material-symbols-outlined">person</span>
        ë‚˜
    </button>
</nav>

<script>
    // v3.4: [ìš”ì²­ 7] ì•± ì´ˆê¸°í™” ê´€ë ¨ ë³€ìˆ˜
    let myPageListenersSet = false; // v3.5: ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¤‘ë³µ ë“±ë¡ ë°©ì§€ í”Œë˜ê·¸

    const KAKAO_REST_API_KEY = "71b46fcb7202af130ab7c6c18bf5163a";

    // v2.6: DOM ìš”ì†Œ ìºì‹± (v3.2ì— ë§ê²Œ ìˆ˜ì •)
    const domElements = {
        startInput: document.getElementById('start-input'),
        endInput: document.getElementById('end-input'),
        targetDistanceInput: document.getElementById('targetDistance'),
        myLocationBtn: document.getElementById('myLocationBtn'),
        searchBtn: document.getElementById('searchBtn'),
        resultArea: document.getElementById('result-area'),
        caloriesDisplay: document.getElementById('calculated-calories'),
        weightLossDisplay: document.getElementById('weight-loss-result'),
        startSuggestions: document.getElementById('start-suggestions'),
        endSuggestions: document.getElementById('end-suggestions'),
        mapNotice: document.getElementById('map-notice'),
        navPanel: document.getElementById('navPanel'),
    };

    // v3.2: Kakao API ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰
    document.addEventListener('DOMContentLoaded', () => {
        // â–¼â–¼â–¼ [ìˆ˜ì • 2/2] kakao.maps.load() ë˜í¼ ì¶”ê°€ â–¼â–¼â–¼
        // Kakao ì§€ë„ APIê°€ ì™„ì „íˆ ë¡œë“œëœ í›„, ëª¨ë“  ì§€ë„ ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
        kakao.maps.load(() => {
            // â–²â–²â–² [ìˆ˜ì • 2/2] ìˆ˜ì • ì‹œì‘ì  â–²â–²â–²
            
            // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™” (v3.4 ê¸°ì¤€)
            let map, ps, geocoder, navElements = domElements; 
            let navMapObjects = []; // í¬ì¼“ëª¬ ê´€ë ¨ ë³€ìˆ˜ ì‚­ì œ
            let userLocation = null; 
            let userLocationCircle = null;
            let startPointFromMyLocation = null;
            let allGeneratedRoutes = { optimal: null, 'round-trip': null, scenic: null };
            let routeGenerationAttempts = { 'round-trip': 0, scenic: 0 }; 

            // v3.4: ì‹ ê·œ ì „ì—­ ë³€ìˆ˜ (ê¸°ë¡, ê·¸ë£¹, ë‚˜)
            let courseHistory = []; // [ìš”ì²­ 4] ê¸°ë¡ ì €ì¥ì„ ìœ„í•œ ë°°ì—´
            let attendanceLog = new Set(); // [ìš”ì²­ 6] ì¶œì„ ê¸°ë¡ (ì¤‘ë³µ ë°©ì§€)
            let fakeGroup = [ // [ìš”ì²­ 5] ê°€ìƒ ê·¸ë£¹ ë°ì´í„°
                { rank: 1, name: "ê°•ì²  ì²´ë ¥ ê¹€ì² ìˆ˜", totalDistance: 350, img: 'https://i.imgur.com/M6LgV7r.png' },
                { rank: 2, name: "ê±·ê¸° ë§ˆìŠ¤í„° ì´ì˜í¬", totalDistance: 320, img: 'https://i.imgur.com/uX8pT1l.png' },
                { rank: 3, name: "ë‹¤ì´ì–´íŠ¸ ì´ˆë³´ì ë°•ë¯¼ìˆ˜", totalDistance: 280, img: 'https://i.imgur.com/4q3J3Y0.png' },
                { rank: 4, name: "ë¯¸ë¼í´ ëª¨ë‹ ìµœìœ ë¦¬", totalDistance: 250, img: 'https://i.imgur.com/Y6O2zQZ.png' },
                { rank: 5, name: "ì˜¤ëŠ˜ë„ ê±·ëŠ”ë‹¤ ì •ìš°ì„±", totalDistance: 200, img: 'https://i.imgur.com/A9aKjR7.png' }
            ];
            // v2.6: ì‚¬ìš©ì ë‹¤ì´ì–´íŠ¸ ì •ë³´
            let dietInfo = {
                gender: localStorage.getItem('diet_gender') || 'male',
                height: parseFloat(localStorage.getItem('diet_height')) || 170,
                currentWeight: parseFloat(localStorage.getItem('diet_current_weight')) || 70,
                targetWeight: parseFloat(localStorage.getItem('diet_target_weight')) || 65,
                goalDate: localStorage.getItem('diet_goal_date') || ''
            };

            /* ========== ì§€ë„ ë° ìœ„ì¹˜ ê´€ë ¨ í•¨ìˆ˜ë“¤ (v3.4 ë¡œì§) ========== */

            /**
             * v3.4: ì´ˆê¸° ì§€ë„ ì„¤ì • ë° ìœ„ì¹˜ ê¸°ë°˜ìœ¼ë¡œ ì‹œì‘ì  ì„¤ì • ì‹œë„
             */
            function initializeDefaultMap() {
                // v3.2: ì§€ë„ ì´ˆê¸°í™” ë° ì¥ì†Œ ê²€ìƒ‰, ì£¼ì†Œ-ì¢Œí‘œ ë³€í™˜ ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
                const defaultPos = new kakao.maps.LatLng(33.450701, 126.570667); // ì œì£¼ ì¹´ì¹´ì˜¤ë³¸ì‚¬
                const mapContainer = document.getElementById('map');
                map = new kakao.maps.Map(mapContainer, { center: defaultPos, level: 3 });
                ps = new kakao.maps.services.Places();
                geocoder = new kakao.maps.services.Geocoder();
                
                // v3.2: ì‚¬ìš©ì í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸° ì‹œë„
                requestUserLocation((location) => {
                    const placeName = "ë‚´ ìœ„ì¹˜";
                    finalizeMyLocation(location, placeName);
                }, (errorMsg) => {
                    // ìœ„ì¹˜ ì‹¤íŒ¨ ì‹œ ë””í´íŠ¸ ìœ„ì¹˜ ì‚¬ìš©
                    updateMapCenter(defaultPos);
                    alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + errorMsg);
                });
            }

            /**
             * v2.6: ì‚¬ìš©ì ìœ„ì¹˜ ì •ë³´ ìš”ì²­
             */
            function requestUserLocation(successCallback, errorCallback) {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            const locPosition = new kakao.maps.LatLng(lat, lng);
                            userLocation = locPosition; // ì „ì—­ ì €ì¥
                            successCallback(locPosition);
                        },
                        (error) => {
                            let msg = "ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                            if (error.code === error.PERMISSION_DENIED) {
                                msg = "ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ì„¤ì •ì—ì„œ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.";
                            }
                            errorCallback(msg);
                        },
                        { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 }
                    );
                } else {
                    errorCallback("ì´ ë¸Œë¼ìš°ì €ëŠ” Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
            }

            /**
             * v2.6: ì§€ë„ì˜ ì¤‘ì‹¬ì„ ì´ë™í•˜ê³  ë§ˆì»¤ í‘œì‹œ
             */
            function updateMapCenter(location) {
                map.panTo(location);
                // v3.2: ë‚´ ìœ„ì¹˜ ë§ˆì»¤ ë° ì› í‘œì‹œ
                if (userLocationCircle) userLocationCircle.setMap(null);
                userLocationCircle = new kakao.maps.Circle({
                    center : location,  // ì›ì˜ ì¤‘ì‹¬ì¢Œí‘œ ì…ë‹ˆë‹¤
                    radius: 50,         // ë¯¸í„° ë‹¨ìœ„ì˜ ì›ì˜ ë°˜ì§€ë¦„ì…ë‹ˆë‹¤
                    strokeWeight: 1,    // ì„ ì˜ ë‘ê»˜ì…ë‹ˆë‹¤ 
                    strokeColor: '#007bff', // ì„ ì˜ ìƒ‰ê¹”ì…ë‹ˆë‹¤
                    strokeOpacity: 0.9, // ì„ ì˜ ë¶ˆíˆ¬ëª…ë„ ì…ë‹ˆë‹¤ 
                    strokeStyle: 'solid', // ì„ ì˜ ìŠ¤íƒ€ì¼ ì…ë‹ˆë‹¤
                    fillColor: '#007bff',    // ì±„ìš°ê¸° ìƒ‰ê¹”ì…ë‹ˆë‹¤
                    fillOpacity: 0.1  // ì±„ìš°ê¸° ë¶ˆíˆ¬ëª…ë„ ì…ë‹ˆë‹¤ 
                }); 
                userLocationCircle.setMap(map);
            }

            /**
             * v2.6: 'ë‚´ ìœ„ì¹˜' ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë  ë©”ì¸ í•¨ìˆ˜ (v3.2ì™€ ë™ì¼)
             */
            function onMyLocationButtonClick() {
                navElements.myLocationBtn.disabled = true;
                navElements.myLocationBtn.textContent = 'ìœ„ì¹˜ ì°¾ëŠ” ì¤‘...';
                requestUserLocation(
                    (location) => {
                        const geocoder = new kakao.maps.services.Geocoder();
                        geocoder.coord2Keyword(location.getLng(), location.getLat(), (data, status) => {
                            let placeName = "ë‚´ ìœ„ì¹˜ (ì¥ì†Œëª… ì—†ìŒ)";
                            if (status === kakao.maps.services.Status.OK && data.length > 0) {
                                // ë„ë¡œëª… ì£¼ì†Œ ë˜ëŠ” ì§€ë²ˆ ì£¼ì†Œ ì¤‘ í•˜ë‚˜ë¥¼ ì‚¬ìš©
                                const address = data[0].road_address || data[0].address;
                                placeName = address.address_name;
                            } else {
                                geocoder.coord2Address(location.getLng(), location.getLat(), (result, status) => {
                                    if (status === kakao.maps.services.Status.OK) {
                                        placeName = result[0].road_address ? result[0].road_address.address_name : result[0].address.address_name;
                                    }
                                    finalizeMyLocation(location, placeName);
                                });
                                return;
                            }
                            finalizeMyLocation(location, placeName);
                        });
                    },
                    (errorMsg) => {
                        alert(errorMsg);
                        navElements.myLocationBtn.disabled = false;
                        navElements.myLocationBtn.textContent = 'ë‚´ ìœ„ì¹˜';
                    }
                );
            }

            /**
             * v2.6: 'ë‚´ ìœ„ì¹˜' ë²„íŠ¼ ì‘ì—… ì™„ë£Œ í›„ (v3.2ì™€ ë™ì¼)
             */
            function finalizeMyLocation(location, placeName) {
                navElements.startInput.value = placeName;
                startPointFromMyLocation = { x: location.getLng(), y: location.getLat(), place_name: placeName };
                updateMapCenter(location);
                navElements.myLocationBtn.disabled = false;
                navElements.myLocationBtn.textContent = 'ë‚´ ìœ„ì¹˜';
            }

            /**
             * v2.6: ì§€ë„ì— í‘œì‹œëœ ê²½ë¡œ ê´€ë ¨ ê°ì²´ë“¤(ë§ˆì»¤, í´ë¦¬ë¼ì¸)ì„ ëª¨ë‘ ì§€ìš°ê³  ì´ˆê¸°í™”
             */
            function clearNavMapObjects() {
                navMapObjects.forEach(obj => obj.setMap(null));
                navMapObjects = [];
            }

            /* ========== ë‚´ë¹„ê²Œì´ì…˜ ê´€ë ¨ í•¨ìˆ˜ë“¤ (v3.4 ë¡œì§) ========== */

            /**
             * v2.6: ì¥ì†Œ ê²€ìƒ‰ (v3.1ê³¼ ë™ì¼)
             */
            const searchPlace = (query, options = {}) => new Promise((resolve, reject) => {
                if (!query.trim()) return reject(new Error("ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤."));
                ps.keywordSearch(query, (data, status) => {
                    if (status === kakao.maps.services.Status.OK && data.length > 0) resolve(data);
                    else if (status === kakao.maps.services.Status.ZERO_RESULT) resolve([]);
                    else reject(new Error(`'${query}' ê²€ìƒ‰ ì‹¤íŒ¨.`));
                }, options);
            });

            /**
             * v2.6: ê²½ë¡œ íƒìƒ‰ (v3.1ê³¼ ë™ì¼)
             */
            
const getRoute = async (waypoints) => {
    const origin = waypoints[0];
    const destination = waypoints[waypoints.length - 1];
    const restWaypoints =
        waypoints.length > 2
            ? waypoints.slice(1, -1).map(wp => `${wp.x},${wp.y}`).join("|")
            : "";

    const params = new URLSearchParams({
        origin: `${origin.x},${origin.y}`,
        destination: `${destination.x},${destination.y}`,
        priority: "DISTANCE"
    });

    if (restWaypoints) params.append("waypoints", restWaypoints);

    const response = await fetch(
        `https://apis-navi.kakaomobility.com/v1/directions?${params.toString()}`,
        {
            method: "GET",
            headers: { Authorization: `KakaoAK ${KAKAO_REST_API_KEY}` }
        }
    );

    if (!response.ok) throw new Error("ê¸¸ì°¾ê¸° API í˜¸ì¶œ ì‹¤íŒ¨");

    const data = await response.json();
    if (!data.routes || data.routes.length === 0)
        throw new Error("ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");

    return data.routes[0];
};

                const path = drawSingleRoutePolyline(routeData, colors[type]);
                
                path.forEach(p => bounds.extend(p));
                
                const waypoints = routeData.waypoints;

                // ë§ˆì»¤ ê·¸ë¦¬ê¸°
                const startMarker = drawMarker(new kakao.maps.LatLng(waypoints[0].y, waypoints[0].x), `<div style="font-weight: bold; padding: 5px; background: white; border: 1px solid #333; border-radius: 5px;">ì¶œë°œ: ${waypoints[0].place_name}</div>`);
                
                if (type === 'optimal') {
                    const endMarker = drawMarker(new kakao.maps.LatLng(waypoints[1].y, waypoints[1].x), `<div style="font-weight: bold; padding: 5px; background: white; border: 1px solid #333; border-radius: 5px;">ë„ì°©: ${waypoints[1].place_name}</div>`);
                } else {
                    // ì™•ë³µ, ì‚°ì±…ë¡œëŠ” ì‹œì‘/ë ë§ˆì»¤ê°€ ê°™ìŒ (ë˜ëŠ” ê²½ìœ ì§€ê°€ ìˆìŒ)
                }

                if (!bounds.isEmpty()) map.setBounds(bounds, { animate: true });
            }

            /**
             * v3.2: ëª©í‘œ ê±°ë¦¬ì— ë§ëŠ” ì™•ë³µ ì½”ìŠ¤ ì‹œë®¬ë ˆì´ì…˜
             */
            
async function generateNonOverlappingLoopCourse(startPoint, targetDistanceMeters, attempt) {
    const km = targetDistanceMeters / 1000;
    const scale = Math.min(Math.max(km / 5, 0.4), 3.0);
    const dx = 0.01 * scale;
    const dy = 0.008 * scale;

    const midPoint = {
        x: startPoint.x + dx,
        y: startPoint.y + dy,
        place_name: startPoint.place_name + " ë£¨í”„"
    };

    const route = await getRoute([startPoint, midPoint, startPoint]);
    route.waypoints = [startPoint, midPoint, startPoint];
    return route;
}


            /**
             * v3.2: ê·¼ì²˜ ì‚°ì±…ë¡œ ì½”ìŠ¤ ì‹œë®¬ë ˆì´ì…˜
             */
            
async function generateNearbyTrailCourse(startPoint, targetDistanceMeters, attempt) {
    const km = targetDistanceMeters / 1000;
    const scale = Math.min(Math.max(km / 5, 0.4), 3.0);
    const sign = attempt % 2 === 0 ? 1 : -1;
    const dx = 0.008 * scale * sign;
    const dy = 0.012 * scale;

    const midPoint = {
        x: startPoint.x + dx,
        y: startPoint.y + dy,
        place_name: startPoint.place_name + " ì‚°ì±…"
    };

    const route = await getRoute([startPoint, midPoint, startPoint]);
    route.waypoints = [startPoint, midPoint, startPoint];
    return route;
}


            /**
             * v3.4: ì½”ìŠ¤ ì¬ìƒì„± (ì™•ë³µ/ì‚°ì±…ë¡œ)
             */
            async function regenerateRoute(type, loadingSpinner, refreshBtn) {
                refreshBtn.style.display = 'none';
                loadingSpinner.style.display = 'inline';
                
                try {
                    const startPoint = allGeneratedRoutes.optimal.waypoints[0];
                    let targetDistanceMeters = parseFloat(navElements.targetDistanceInput.value) * 1000;
                    if (!targetDistanceMeters || targetDistanceMeters === 0) {
                        targetDistanceMeters = 5000;
                        navElements.targetDistanceInput.value = 5;
                    }
                    routeGenerationAttempts[type]++;
                    let newRoute = null;

                    if (type === 'round-trip') {
                        newRoute = await generateNonOverlappingLoopCourse(startPoint, targetDistanceMeters, routeGenerationAttempts[type]);
                    } else if (type === 'scenic') {
                        newRoute = await generateNearbyTrailCourse(startPoint, targetDistanceMeters, routeGenerationAttempts[type]);
                    }

                    if (newRoute) {
                        allGeneratedRoutes[type] = newRoute;
                        displayRouteInfo(newRoute, type);
                    } else {
                        throw new Error("ìƒˆë¡œìš´ ì½”ìŠ¤ë¥¼ ì°¾ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    }
                } catch (error) {
                    alert(error.message);
                    loadingSpinner.style.display = 'none';
                    refreshBtn.style.display = 'inline';
                }
            }


            /**
             * v2.6: 'ì½”ìŠ¤ ìƒì„±' ë²„íŠ¼ í´ë¦­ (v3.4 ë¡œì§)
             */
            async function onSearchButtonClick() {
                navElements.resultArea.innerHTML = '<p>ì½”ìŠ¤ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤... (ìµœëŒ€ 10ì´ˆ ì†Œìš”)</p>';
                clearNavMapObjects();
                routeGenerationAttempts = { 'round-trip': 0, scenic: 0 }; // v3.2: ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê¸°í™”

                // 1. ì¶œë°œì§€/ë„ì°©ì§€ ì¢Œí‘œ ê°€ì ¸ì˜¤ê¸°
                let startPlaces;
                try {
                    startPlaces = await searchPlace(navElements.startInput.value);
                } catch (e) {
                    navElements.resultArea.innerHTML = `<p>ì¶œë°œì§€ ê²€ìƒ‰ ì‹¤íŒ¨: ${e.message}</p>`;
                    return;
                }
                if (startPlaces.length === 0) { navElements.resultArea.innerHTML = '<p>ì¶œë°œì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }
                const startPoint = { x: startPlaces[0].x, y: startPlaces[0].y, place_name: startPlaces[0].place_name };

                // 2. ëª©í‘œ ê±°ë¦¬ì— ë”°ë¥¸ ì½”ìŠ¤ ìƒì„±/ê²€ìƒ‰ ê²°ì •
                const targetDistanceKM = parseFloat(navElements.targetDistanceInput.value);
                let endPoint = null;
                if (navElements.endInput.value.trim() && navElements.endInput.value.trim() !== 'ì¶œë°œì§€ì™€ ê°™ìŒ') {
                    // ë„ì°©ì§€ ì…ë ¥ ì‹œ: ìµœì  ì½”ìŠ¤ ê²€ìƒ‰
                    let endPlaces;
                    try {
                        endPlaces = await searchPlace(navElements.endInput.value);
                    } catch (e) {
                        navElements.resultArea.innerHTML = `<p>ë„ì°©ì§€ ê²€ìƒ‰ ì‹¤íŒ¨: ${e.message}</p>`;
                        return;
                    }
                    if (endPlaces.length === 0) { navElements.resultArea.innerHTML = '<p>ë„ì°©ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }
                    endPoint = { x: endPlaces[0].x, y: endPlaces[0].y, place_name: endPlaces[0].place_name };
                } else if (!isNaN(targetDistanceKM) && targetDistanceKM > 0) {
                    // ëª©í‘œ ê±°ë¦¬ ì…ë ¥ ì‹œ: ì™•ë³µ/ì‚°ì±…ë¡œ ì½”ìŠ¤ ìƒì„± (ë„ì°©ì ì€ ìƒëµ)
                    endPoint = startPoint; // ì™•ë³µ/ë£¨í”„ ì½”ìŠ¤ì´ë¯€ë¡œ ë„ì°©ì§€ëŠ” ì¶œë°œì§€ì™€ ë™ì¼í•˜ê²Œ ì„¤ì •
                } else {
                    navElements.resultArea.innerHTML = '<p>ë„ì°©ì§€ ì…ë ¥ ë˜ëŠ” ìœ íš¨í•œ ëª©í‘œ ê±°ë¦¬(km)ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>';
                    return;
                }
                
                // 3. (v3.4) ëª¨ë“  ì¹´ë“œ ê²°ê³¼ ì´ˆê¸°í™”
                allGeneratedRoutes = { optimal: null, 'round-trip': null, scenic: null };

                // 4. (v3.4) ëª¨ë“  ì½”ìŠ¤ ìƒì„± Promise
                const promises = [];
                promises.push(
                    (async () => {
                        if (navElements.endInput.value.trim() && navElements.endInput.value.trim() !== 'ì¶œë°œì§€ì™€ ê°™ìŒ') {
                            // ìµœì  ì½”ìŠ¤
                            const optimalRoute = await getRoute([startPoint, endPoint]);
                            optimalRoute.waypoints = [startPoint, endPoint];
                            return { type: 'optimal', route: optimalRoute };
                        }
                        return { type: 'optimal', route: null };
                    })()
                );

                if (!isNaN(targetDistanceKM) && targetDistanceKM > 0) {
                    // ì™•ë³µ ì½”ìŠ¤ (ë£¨í”„)
                    promises.push(
                        (async () => {
                            const loopRoute = await generateNonOverlappingLoopCourse(startPoint, targetDistanceKM * 1000, 1);
                            loopRoute.waypoints = [startPoint, startPoint]; // ì‹œì‘=ë„ì°©
                            return { type: 'round-trip', route: loopRoute };
                        })()
                    );
                    
                    // ê·¼ì²˜ ì‚°ì±…ë¡œ ì½”ìŠ¤
                    promises.push(
                        (async () => {
                            const trailRoute = await generateNearbyTrailCourse(startPoint, targetDistanceKM * 1000, 1);
                            trailRoute.waypoints = [startPoint, startPoint]; // ì‹œì‘=ë„ì°©
                            return { type: 'scenic', route: trailRoute };
                        })()
                    );
                }

                // 5. ëª¨ë“  ë¹„ë™ê¸° ì½”ìŠ¤ ìƒì„± ê¸°ë‹¤ë¦¬ê¸°
                const results = await Promise.allSettled(promises);

                // 6. (v3.4) ê²°ê³¼ ì¹´ë“œ HTML ì´ˆê¸°í™”
                navElements.resultArea.innerHTML = `
                    <div class="route-card optimal" id="card-optimal" style="display: none;">
                        <div class="card-header">
                            <h3>ğŸ¯ ìµœì  ì½”ìŠ¤</h3>
                            <span class="card-loading" style="display: none;">ğŸ”„</span>
                            <button class="card-refresh-btn hidden">ğŸ”„</button>
                        </div>
                        <p class="card-distance">ê±°ë¦¬:</p><p class="card-duration">ì‹œê°„:</p><p class="card-calories">ì†Œëª¨:</p>
                        <button class="card-save-btn">ğŸ’¾</button>
                    </div>
                    <div class="route-card round-trip" id="card-round-trip" style="display: none;">
                        <div class="card-header">
                            <h3>ğŸ”„ ì™•ë³µ ì½”ìŠ¤</h3>
                            <span class="card-loading" style="display: none;">ğŸ”„</span>
                            <button class="card-refresh-btn">ğŸ”„</button>
                        </div>
                        <p class="card-distance">ê±°ë¦¬:</p><p class="card-duration">ì‹œê°„:</p><p class="card-calories">ì†Œëª¨:</p>
                        <button class="card-save-btn">ğŸ’¾</button>
                    </div>
                    <div class="route-card scenic" id="card-scenic" style="display: none;">
                        <div class="card-header">
                            <h3>ğŸŒ³ ê·¼ì²˜ ì‚°ì±…ë¡œ</h3>
                            <span class="card-loading" style="display: none;">ğŸ”„</span>
                            <button class="card-refresh-btn">ğŸ”„</button>
                        </div>
                        <p class="card-distance">ê±°ë¦¬:</p><p class="card-duration">ì‹œê°„:</p><p class="card-calories">ì†Œëª¨:</p>
                        <button class="card-save-btn">ğŸ’¾</button>
                    </div>`;
                
                // 7. (v3.4) ê° ì¹´ë“œì— ê²°ê³¼ ì±„ìš°ê¸°
                allGeneratedRoutes = { optimal: null, 'round-trip': null, scenic: null };
                let firstRouteType = null;

                results.forEach(result => {
                    if (result.status === 'fulfilled' && result.value.route) {
                        const type = result.value.type;
                        allGeneratedRoutes[type] = result.value.route;
                        if (!firstRouteType) firstRouteType = type;
                        displayRouteInfo(result.value.route, type);
                    } else if (result.status === 'rejected') {
                        console.error(`ì½”ìŠ¤ ìƒì„± ì‹¤íŒ¨ (${result.reason.message})`);
                    }
                });

                // 8. (v3.4) ê²°ê³¼ê°€ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ ë©”ì‹œì§€ í‘œì‹œ, ì•„ë‹ˆë©´ ì²« ë²ˆì§¸ ê²½ë¡œ í‘œì‹œ
                if (!firstRouteType) {
                    navElements.resultArea.innerHTML = '<p>ìš”ì²­í•˜ì‹  ì¡°ê±´ì— ë§ëŠ” ì½”ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                } else {
                    drawSingleRoute(firstRouteType);
                }

                // 9. (v3.4) ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ì„¤ì •
                document.querySelectorAll('.route-card').forEach(card => {
                    card.onclick = (e) => {
                        // ì¹´ë“œ ìì²´ë¥¼ í´ë¦­í–ˆì„ ë•Œë§Œ ê²½ë¡œ ê·¸ë¦¬ê¸° (ë²„íŠ¼ í´ë¦­ ë¬´ì‹œ)
                        if (e.target.tagName !== 'BUTTON' && e.target.tagName !== 'SPAN') {
                            const type = card.id.replace('card-', '');
                            drawSingleRoute(type);
                        }
                    };
                    
                    // ì¬ìƒì„± ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ
                    const refreshBtn = card.querySelector('.card-refresh-btn');
                    const loadingSpinner = card.querySelector('.card-loading');
                    if (refreshBtn && !refreshBtn.classList.contains('hidden')) {
                        refreshBtn.onclick = (e) => {
                            e.stopPropagation(); // ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ë§‰ê¸°
                            const type = card.id.replace('card-', '');
                            regenerateRoute(type, loadingSpinner, refreshBtn);
                        };
                    }

                    // ì €ì¥ ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ
                    const saveBtn = card.querySelector('.card-save-btn');
                    if (saveBtn) {
                        saveBtn.onclick = (e) => {
                            e.stopPropagation();
                            saveCourse(card.id.replace('card-', ''));
                        }
                    }
                });
            }

            /**
             * v2.6: ê²½ë¡œ ì •ë³´ë¥¼ ì¹´ë“œì— í‘œì‹œ (v3.4 ë¡œì§)
             */
            function displayRouteInfo(route, type) {
                const card = document.getElementById(`card-${type}`);
                if (!card) return;

                card.style.display = 'flex';
                card.querySelector('.card-distance').textContent = `ê±°ë¦¬: ${(route.summary.distance / 1000).toFixed(2)} km`;
                const durationMinutes = Math.round(route.summary.duration / 60);
                card.querySelector('.card-duration').textContent = `ì‹œê°„: ì•½ ${durationMinutes} ë¶„`;
                
                // ì¹¼ë¡œë¦¬ ê³„ì‚° (v2.6)
                const calories = calculateCalories(route.summary.distance, dietInfo.currentWeight, durationMinutes);
                card.querySelector('.card-calories').textContent = `ì†Œëª¨: ${calories.toFixed(0)} kcal`;

                // ë¡œë”©/ì¬ìƒì„± ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
                const loadingSpinner = card.querySelector('.card-loading');
                const refreshBtn = card.querySelector('.card-refresh-btn');
                if (loadingSpinner) loadingSpinner.style.display = 'none';
                if (refreshBtn) refreshBtn.style.display = refreshBtn.classList.contains('hidden') ? 'none' : 'inline';
            }

            /**
             * v2.6: ì¹¼ë¡œë¦¬ ê³„ì‚° í•¨ìˆ˜ (METs ë°©ì‹ ê¸°ë°˜)
             */
            function calculateCalories(distanceMeters, weightKG, durationMinutes) {
                // 4.5km/h = 4.3 METs (ë³´í†µ ê±·ê¸°)
                const METs = 4.3;
                const durationHours = durationMinutes / 60;
                const calories = METs * 3.5 * weightKG * durationHours / 200; // METs * 3.5 * ì²´ì¤‘(kg) * ì‹œê°„(ë¶„) / 200
                // v3.2: ê²½ë¡œì˜ ê±°ë¦¬ê°€ ë” ì¤‘ìš”í•˜ë¯€ë¡œ ê±°ë¦¬ ê¸°ë°˜ ë³´ì •
                const distanceRatio = (distanceMeters / 1000) / (durationMinutes / 60 * 4.5); // ê±·ê¸° ì†ë„ 4.5km/h ê°€ì •
                return calories * distanceRatio;
            }

            /**
             * v3.4: ì½”ìŠ¤ ê¸°ë¡ ì €ì¥
             */
            function saveCourse(type) {
                const route = allGeneratedRoutes[type];
                if (!route) {
                    alert('ì €ì¥í•  ì½”ìŠ¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // v3.4: í˜„ì¬ ì§€ë„ ìƒíƒœ ìº¡ì²˜ (ê°€ìƒ)
                const staticMapUrl = 'https://via.placeholder.com/320x200?text=Course+Map'; // ì‹¤ì œ ì§€ë„ ìº¡ì²˜ ëŒ€ì‹  placeholder ì‚¬ìš©
                
                const newCourse = {
                    title: document.getElementById(`card-${type}`).querySelector('h3').textContent.trim(),
                    type: type, // optimal, round-trip, scenic
                    distance: route.summary.distance,
                    duration: route.summary.duration,
                    calories: calculateCalories(route.summary.distance, dietInfo.currentWeight, Math.round(route.summary.duration / 60)),
                    savedDate: new Date(),
                    staticMapUrl: staticMapUrl
                };
                
                courseHistory.push(newCourse);
                alert(`${newCourse.title} ì½”ìŠ¤ë¥¼ ê¸°ë¡ì— ì €ì¥í–ˆìŠµë‹ˆë‹¤!`);
            }

            /* ========== ì¥ì†Œ ê²€ìƒ‰ ìë™ ì™„ì„± ë¡œì§ (v3.1ê³¼ ë™ì¼) ========== */
            const setupAutocomplete = (inputElement, suggestionsElement) => {
                let currentFocus = -1;

                inputElement.addEventListener('input', async () => {
                    const val = inputElement.value;
                    suggestionsElement.innerHTML = '';
                    currentFocus = -1;

                    if (!val) {
                        suggestionsElement.style.display = 'none';
                        return;
                    }
                    suggestionsElement.style.display = 'block';

                    try {
                        const results = await searchPlace(val);
                        
                        results.forEach((place, index) => {
                            const item = document.createElement('div');
                            item.classList.add('suggestion-item');
                            item.innerHTML = `<strong>${place.place_name}</strong><br><small>${place.address_name}</small>`;
                            item.setAttribute('data-index', index);
                            item.onclick = () => {
                                inputElement.value = place.address_name; // ì£¼ì†Œëª…ìœ¼ë¡œ ì…ë ¥
                                suggestionsElement.innerHTML = '';
                                suggestionsElement.style.display = 'none';
                            };
                            suggestionsElement.appendChild(item);
                        });
                        
                    } catch (e) {
                        suggestionsElement.innerHTML = `<div class="suggestion-item" style="color: red;">ê²€ìƒ‰ ì˜¤ë¥˜: ${e.message}</div>`;
                    }
                });

                // í¬ì»¤ìŠ¤ ì´ë™ ì²˜ë¦¬ (í‚¤ë³´ë“œ)
                inputElement.addEventListener('keydown', (e) => {
                    let items = suggestionsElement.querySelectorAll('.suggestion-item');
                    if (items.length === 0) return;
                    
                    if (e.keyCode === 40) { // Down
                        currentFocus = Math.min(items.length - 1, currentFocus + 1);
                        updateActiveSuggestion(items);
                    } else if (e.keyCode === 38) { // Up
                        currentFocus = Math.max(-1, currentFocus - 1);
                        updateActiveSuggestion(items);
                    } else if (e.keyCode === 13) { // Enter
                        e.preventDefault();
                        if (currentFocus > -1) {
                            items[currentFocus].click();
                        }
                    }
                });

                function updateActiveSuggestion(items) {
                    items.forEach(item => item.classList.remove('active'));
                    if (currentFocus > -1) items[currentFocus].classList.add('active');
                }

                // ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
                document.addEventListener('click', (e) => {
                    if (e.target !== inputElement) {
                        suggestionsElement.style.display = 'none';
                    }
                });
            };

            setupAutocomplete(navElements.startInput, navElements.startSuggestions);
            setupAutocomplete(navElements.endInput, navElements.endSuggestions);
            navElements.myLocationBtn.onclick = onMyLocationButtonClick;
            navElements.searchBtn.onclick = onSearchButtonClick;

            /* ========== ë‹¤ì´ì–´íŠ¸ ì •ë³´ ëª¨ë‹¬ ë¡œì§ (v3.2) ========== */
            const dietInfoModal = document.getElementById('dietInfoModal');
            const genderSelect = document.getElementById('gender-select');
            const heightInput = document.getElementById('height-input');
            const currentWeightInput = document.getElementById('current-weight-input');
            const targetWeightInput = document.getElementById('target-weight-input');
            const goalDateInput = document.getElementById('goal-date-input');
            const saveInfoBtn = document.getElementById('saveInfoBtn');
            const characterImage = document.getElementById('characterImage');
            const infoCurrentWeight = document.getElementById('info-current-weight');
            const infoTargetWeight = document.getElementById('info-target-weight');
            const progressText = document.getElementById('progress-text');
            const barAchieved = document.getElementById('bar-achieved');
            const barExcess = document.getElementById('bar-excess');

            function updateCharacter(gender, bmi) {
                const bodyType = (bmi < 18.5) ? 'lean' : 
                                 (bmi < 25) ? 'average' : 
                                 (bmi < 30) ? 'overweight' : 'obese';
                const imgMap = {
                    male: { lean: 'https://i.imgur.com/91TKFuE.png', average: 'https://i.imgur.com/ecc7NYi.png', overweight: 'https://i.imgur.com/QJZsUvT.png', obese: 'https://i.imgur.com/qGxG0QR.png' },
                    female: { lean: 'https://i.imgur.com/2bsZnpy.png', average: 'https://i.imgur.com/X0k8ZfB.png', overweight: 'https://i.imgur.com/L3k9S2d.png', obese: 'https://i.imgur.com/k2jP7oO.png' }
                };
                characterImage.src = imgMap[gender][bodyType];
            }

            function loadDietInfo() {
                dietInfo.gender = localStorage.getItem('diet_gender') || 'male';
                dietInfo.height = parseFloat(localStorage.getItem('diet_height')) || 170;
                dietInfo.currentWeight = parseFloat(localStorage.getItem('diet_current_weight')) || 70;
                dietInfo.targetWeight = parseFloat(localStorage.getItem('diet_target_weight')) || 65;
                dietInfo.goalDate = localStorage.getItem('diet_goal_date') || '';
                
                genderSelect.value = dietInfo.gender;
                heightInput.value = dietInfo.height;
                currentWeightInput.value = dietInfo.currentWeight;
                targetWeightInput.value = dietInfo.targetWeight;
                goalDateInput.value = dietInfo.goalDate;
                
                updateMyPageInfo();
            }

            function saveDietInfo() {
                dietInfo.gender = genderSelect.value;
                dietInfo.height = parseFloat(heightInput.value);
                dietInfo.currentWeight = parseFloat(currentWeightInput.value);
                dietInfo.targetWeight = parseFloat(targetWeightInput.value);
                dietInfo.goalDate = goalDateInput.value;

                localStorage.setItem('diet_gender', dietInfo.gender);
                localStorage.setItem('diet_height', dietInfo.height);
                localStorage.setItem('diet_current_weight', dietInfo.currentWeight);
                localStorage.setItem('diet_target_weight', dietInfo.targetWeight);
                localStorage.setItem('diet_goal_date', dietInfo.goalDate);

                updateMyPageInfo();
                dietInfoModal.style.display = 'none';
            }

            function updateMyPageInfo() {
                const h = dietInfo.height / 100;
                const bmi = dietInfo.currentWeight / (h * h);
                const goalLoss = dietInfo.currentWeight - dietInfo.targetWeight;
                const totalCalories = parseFloat(localStorage.getItem('total_calories')) || 0;
                
                // ì²´ì§€ë°© 1kg = 7700 kcal
                const currentLoss = totalCalories / 7700;
                localStorage.setItem('total_weight_loss', currentLoss.toFixed(2));
                
                infoCurrentWeight.textContent = `í˜„ì¬ ì²´ì¤‘: ${dietInfo.currentWeight} kg (BMI: ${bmi.toFixed(1)})`;
                infoTargetWeight.textContent = `ëª©í‘œ ì²´ì¤‘: ${dietInfo.targetWeight} kg (ê°ëŸ‰ ëª©í‘œ: ${goalLoss.toFixed(1)} kg)`;
                
                updateCharacter(dietInfo.gender, bmi);

                // ëª©í‘œ ë‹¬ì„± ì§„í–‰ë¥  í‘œì‹œ
                if (goalLoss > 0) {
                    const progress = Math.min(100, (currentLoss / goalLoss) * 100);
                    progressText.textContent = `ì§„í–‰ë¥ : ${currentLoss.toFixed(1)} kg / ${goalLoss.toFixed(1)} kg (${progress.toFixed(1)}%)`;
                    barAchieved.style.width = `${progress}%`;
                    barExcess.style.width = '0%';
                } else if (goalLoss < 0) {
                    // ì¦ëŸ‰ ëª©í‘œì¼ ê²½ìš° (ëª©í‘œ ì²´ì¤‘ > í˜„ì¬ ì²´ì¤‘)
                    const requiredGain = Math.abs(goalLoss);
                    const progress = Math.min(100, (currentLoss / requiredGain) * 100); // ëª©í‘œê¹Œì§€ ë‚¨ì€ ë¬´ê²Œ ëŒ€ë¹„ ë‹¬ì„±ë¥ 
                    progressText.textContent = `ì¦ëŸ‰ ì§„í–‰ë¥ : ${currentLoss.toFixed(1)} kg / ${requiredGain.toFixed(1)} kg`;
                    barAchieved.style.width = `${progress}%`;
                    barExcess.style.width = '0%';
                } else {
                    progressText.textContent = 'ëª©í‘œ ì²´ì¤‘ê³¼ í˜„ì¬ ì²´ì¤‘ì´ ê°™ìŠµë‹ˆë‹¤.';
                    barAchieved.style.width = '0%';
                    barExcess.style.width = '0%';
                }

                // ë©”ì¸ í˜ì´ì§€ ì¹¼ë¡œë¦¬/ì²´ì¤‘ ê°ì†Œ ì—…ë°ì´íŠ¸
                const totalWalkedDistance = parseFloat(localStorage.getItem('total_walked_distance')) || 0;
                const totalDurationMinutes = parseFloat(localStorage.getItem('total_duration_minutes')) || 0;
                
                // ë©”ì¸ í˜ì´ì§€ ëª©í‘œ ê±°ë¦¬/ì‹œê°„ì„ ì¹¼ë¡œë¦¬ë¡œ ë³€í™˜ (ì„ì‹œê°’)
                const targetDistanceKM = parseFloat(navElements.targetDistanceInput.value) || 5;
                const targetDurationMinutes = targetDistanceKM / 4.5 * 60; // 4.5km/h ê¸°ì¤€
                const calculatedCalories = calculateCalories(targetDistanceKM * 1000, dietInfo.currentWeight, targetDurationMinutes);

                navElements.caloriesDisplay.textContent = `${calculatedCalories.toFixed(0)} kcal ì†Œëª¨`;
                navElements.weightLossDisplay.textContent = `(${(calculatedCalories / 7700).toFixed(1)} kg ê°ëŸ‰)`;
            }

            // ì´ˆê¸°í™” ì‹œ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
            loadDietInfo();
            saveInfoBtn.onclick = saveDietInfo;

            // ëª¨ë‹¬ ë‹«ê¸° í•¸ë“¤ëŸ¬
            window.onclick = (event) => {
                if (event.target.classList.contains('modal')) event.target.style.display = 'none';
            };

            /* ========== (v3.4) [ìš”ì²­ 2] íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ë¡œì§ ========== */
            
            // v3.4: íƒ­/í˜ì´ì§€ DOM ìš”ì†Œ
            const pages = {
                home: document.getElementById('page-home'),
                history: document.getElementById('page-history'),
                group: document.getElementById('page-group'),
                me: document.getElementById('page-me')
            };
            const navButtons = {
                home: document.getElementById('nav-btn-home'),
                history: document.getElementById('nav-btn-history'),
                group: document.getElementById('nav-btn-group'),
                me: document.getElementById('nav-btn-me')
            };

            // v3.4: íƒ­ ì „í™˜ì„ ì²˜ë¦¬í•˜ëŠ” ê³µí†µ í•¨ìˆ˜
            function showPage(pageId) {
                // ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¸°ê¸°
                Object.values(pages).forEach(page => page.style.display = 'none');
                // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
                Object.values(navButtons).forEach(btn => btn.classList.remove('active'));

                // ìš”ì²­ëœ í˜ì´ì§€ë§Œ ë³´ì´ê¸°
                pages[pageId].style.display = 'block';
                // ìš”ì²­ëœ ë²„íŠ¼ë§Œ í™œì„±í™”
                navButtons[pageId].classList.add('active');

                // v3.4: ê° í˜ì´ì§€ê°€ ë³´ì¼ ë•Œ ì»¨í…ì¸  ìƒˆë¡œê³ ì¹¨
                if (pageId === 'history') renderHistoryPage();
                if (pageId === 'group') renderGroupPage();
                if (pageId === 'me') renderMyPage();
            }

            // v3.4: íƒ­ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            function setupTabNavigation() {
                navButtons.home.addEventListener('click', () => showPage('home'));
                navButtons.history.addEventListener('click', () => showPage('history'));
                navButtons.group.addEventListener('click', () => showPage('group'));
                navButtons.me.addEventListener('click', () => showPage('me'));
            }

            /* ========== (v3.4) [ìš”ì²­ 4] 'ê¸°ë¡' í˜ì´ì§€ ë¡œì§ ========== */
            
            // v3.4: [ìš”ì²­ 4] ê¸°ë¡ í˜ì´ì§€ ë Œë”ë§
            function renderHistoryPage() {
                const container = document.getElementById('page-history-content');
                if (courseHistory.length === 0) {
                    container.innerHTML = '<p>ì•„ì§ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. í™ˆì—ì„œ ì½”ìŠ¤ë¥¼ ê²€ìƒ‰í•˜ê³  [ğŸ’¾ ì €ì¥] ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.</p>';
                    return;
                }
                
                container.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”
                
                // ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
                courseHistory.slice().reverse().forEach(course => {
                    const dateStr = course.savedDate.toLocaleString('ko-KR');
                    const typeInfo = {
                        optimal: { name: 'ìµœì  ê²½ë¡œ', class: 'optimal' },
                        'round-trip': { name: 'ì™•ë³µ ì½”ìŠ¤', class: 'round-trip' },
                        scenic: { name: 'ê·¼ì²˜ ì‚°ì±…ë¡œ', class: 'scenic' }
                    };
                    
                    const cardHTML = `
                        <div class="history-card">
                            <img src="${course.staticMapUrl}" alt="ì½”ìŠ¤ ì§€ë„">
                            <div class="history-card-content">
                                <h3>${course.title}</h3>
                                <p><span class="history-badge ${typeInfo[course.type].class}">${typeInfo[course.type].name}</span></p>
                                <p><strong>ê±°ë¦¬:</strong> ${(course.distance / 1000).toFixed(2)} km</p>
                                <p><strong>ì‹œê°„:</strong> ${Math.round(course.duration / 60)} ë¶„</p>
                                <p><small>ì €ì¥ì¼: ${dateStr}</small></p>
                            </div>
                        </div>
                    `;
                    container.innerHTML += cardHTML;
                });
            }

            /* ========== (v3.4) [ìš”ì²­ 5] 'ê·¸ë£¹' í˜ì´ì§€ ë¡œì§ ========== */

            // v3.4: [ìš”ì²­ 5] ê·¸ë£¹ í˜ì´ì§€ ë Œë”ë§
            function renderGroupPage() {
                const container = document.getElementById('page-group-content');
                const listHTML = `<ul class="group-list">` +
                    fakeGroup.map(member => `
                        <li class="group-list-item">
                            <div class="rank">#${member.rank}</div>
                            <img src="${member.img}" alt="${member.name}">
                            <div class="info">
                                <strong>${member.name}</strong><br>
                                <span>ì´ë²ˆ ë‹¬ ${member.totalDistance} km</span>
                            </div>
                        </li>
                    `).join('') +
                    `</ul>`;
                container.innerHTML = listHTML;
            }

            /* ========== (v3.4) [ìš”ì²­ 6] 'ë‚˜' í˜ì´ì§€ ë¡œì§ ========== */

            // v3.5: 'ë‚˜' í˜ì´ì§€ ë Œë”ë§
            function renderMyPage() {
                // v3.4: í†µê³„ ì—…ë°ì´íŠ¸
                const totalDistance = courseHistory.reduce((sum, course) => sum + course.distance, 0);
                document.getElementById('total-walked-dist').textContent = (totalDistance / 1000).toFixed(2) + ' km';
                document.getElementById('total-attendance-days').textContent = attendanceLog.size + ' ì¼';
                localStorage.setItem('total_walked_distance', (totalDistance / 1000).toFixed(2));
                
                // v3.5: ë‹¤ì´ì–´íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸ (í˜„ì¬ ì²´ì¤‘ ë“±)
                updateMyPageInfo(); 

                // v3.4: ì¶œì„ ë‹¬ë ¥ ì—…ë°ì´íŠ¸
                const calendarGrid = document.getElementById('calendar-grid');
                calendarGrid.innerHTML = '';
                const today = new Date();
                const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
                
                for (let i = 1; i <= daysInMonth; i++) {
                    const date = new Date(today.getFullYear(), today.getMonth(), i);
                    const dateStr = date.toDateString();
                    const dayEl = document.createElement('div');
                    dayEl.classList.add('calendar-day');
                    if (attendanceLog.has(dateStr)) {
                        dayEl.classList.add('checked');
                        dayEl.innerHTML = `<span>${i} âœ…</span>`;
                    } else {
                        dayEl.innerHTML = `<span>${i}</span>`;
                    }
                    calendarGrid.appendChild(dayEl);
                }

                // v3.4: ì¶œì„ ë²„íŠ¼ ìƒíƒœ
                const todayStr = today.toDateString();
                const checkinBtn = document.getElementById('btnCheckAttendance');
                if (attendanceLog.has(todayStr)) {
                    checkinBtn.disabled = true;
                    checkinBtn.textContent = 'ì˜¤ëŠ˜ ì¶œì„ ì™„ë£Œ âœ…';
                } else {
                    checkinBtn.disabled = false;
                    checkinBtn.textContent = 'ì˜¤ëŠ˜ ì¶œì„ì²´í¬';
                }
                
                // v3.5: ë¦¬ìŠ¤ë„ˆëŠ” í•œ ë²ˆë§Œ ë“±ë¡
                if (!myPageListenersSet) {
                    document.getElementById('openModalBtn').onclick = () => document.getElementById('dietInfoModal').style.display = 'flex';
                    checkinBtn.onclick = checkAttendance; // ì¶œì„ ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ

                    myPageListenersSet = true;
                }
                // v3.5: ì¶œì„ ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆëŠ” ìƒíƒœê°€ ë³€ê²½ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë§¤ë²ˆ ì¬ë“±ë¡ (ì•ˆì „ì¥ì¹˜)
                checkinBtn.onclick = checkAttendance;
            }

            // v3.4: [ìš”ì²­ 6] ì¶œì„ì²´í¬ ë²„íŠ¼ í´ë¦­
            function checkAttendance() {
                const todayStr = new Date().toDateString();
                if (!attendanceLog.has(todayStr)) {
                    attendanceLog.add(todayStr);
                    alert('ì¶œì„ì²´í¬ ì™„ë£Œ! ğŸ¥³');
                    renderMyPage(); // 'ë‚˜' í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                }
            }


            /* ========== (v3.4) [ìš”ì²­ 7] ì•± ì´ˆê¸°í™” ========== */
            initializeDefaultMap(); // v3.4 [ìš”ì²­ 7] ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
            setupTabNavigation(); // v3.4 [ìš”ì²­ 2] íƒ­ ì„¤ì •

        // â–²â–²â–² [ìˆ˜ì • 2/2] ìˆ˜ì • ì¢…ë£Œì  â–²â–²â–²
        }); // â–¼â–¼â–¼ kakao.maps.load() ë˜í¼ ë‹«ê¸° â–¼â–¼â–¼
    });
</script>
</body>
</html>