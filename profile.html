<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>POKE RUN: PROFILE</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined|Material+Icons" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:ital,wght@0,400;0,700;1,900&family=Inter:wght@400;700;900&family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="layout.css">

    <style>
        :root { 
            --volt: #2563eb; 
            --bg-main: #f0f4f8; 
            --bg-card: #ffffff; 
            --bg-sub: #e5e7eb; 
            --text-main: #1a1a1a; 
            --text-sub: #4b5563; 
            --border-color: #d1d5db; 
        }

        html, body { 
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: var(--bg-main);
            color: var(--text-main);
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            touch-action: pan-y;
        }

        .font-sport { font-family: 'Chakra Petch', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>
</head>

<body class="flex justify-center h-screen bg-[var(--bg-main)]">

<div class="w-full max-w-md h-full relative bg-[var(--bg-main)] flex flex-col border-x border-[var(--border-color)] sm:border-x-0">

    <main class="app-content">

        <div class="px-4 pt-14 pb-6">
            <div class="flex items-center justify-between mb-4">
                <div class="relative group cursor-pointer" onclick="openEditProfileModal()">
                    <div class="w-20 h-20 rounded-full p-[2px] bg-gradient-to-tr from-[var(--volt)] to-purple-500">
                        <img id="my-profile-img" class="w-full h-full rounded-full border-2 border-[var(--bg-main)] object-cover bg-[var(--bg-card)]">
                    </div>
                    <div class="absolute bottom-0 right-0 bg-[var(--volt)] text-black rounded-full p-1 border-2 border-[var(--bg-main)]">
                        <i data-lucide="pencil" class="w-3 h-3"></i>
                    </div>
                </div>

                <div class="flex-1 flex justify-around ml-4">
                    <div class="flex flex-col items-center">
                        <span id="post-count" class="font-bold text-lg">0</span>
                        <span class="text-xs text-[var(--text-sub)]">게시물</span>
                    </div>
                    <button onclick="openUserListModal('followers')" class="flex flex-col items-center">
                        <span id="follower-count" class="font-bold text-lg">0</span>
                        <span class="text-xs text-[var(--text-sub)]">팔로워</span>
                    </button>
                    <button onclick="openUserListModal('following')" class="flex flex-col items-center">
                        <span id="following-count" class="font-bold text-lg">0</span>
                        <span class="text-xs text-[var(--text-sub)]">팔로잉</span>
                    </button>
                </div>
            </div>

            <div class="mb-5">
                <h3 id="my-profile-name" class="font-bold text-sm">Loading...</h3>
                <p id="my-profile-bio" class="text-xs text-[var(--text-sub)] mt-1">상태 메시지를 입력해주세요.</p>
            </div>

            <div class="flex gap-2 text-sm font-bold">
                <button onclick="openEditProfileModal()" class="flex-1 bg-[var(--bg-sub)] py-1.5 rounded-lg border border-[var(--border-color)]">프로필 편집</button>
                <button class="flex-1 bg-[var(--bg-sub)] py-1.5 rounded-lg border border-[var(--border-color)]">프로필 공유</button>
            </div>
        </div>

        <div class="flex border-t border-[var(--border-color)]">
            <button id="tab-btn-posts" onclick="switchTab('posts')" class="flex-1 py-3 border-b-2 border-[var(--text-main)] flex justify-center">
                <i data-lucide="grid-3x3"></i>
            </button>
            <button id="tab-btn-reels" onclick="switchTab('reels')" class="flex-1 py-3 flex justify-center text-[var(--text-sub)]">
                <i data-lucide="clapperboard"></i>
            </button>
            <button id="tab-btn-tags" onclick="switchTab('tags')" class="flex-1 py-3 flex justify-center text-[var(--text-sub)]">
                <i data-lucide="user-check"></i>
            </button>
        </div>

        <div id="tab-content-posts">
            <div id="my-post-grid" class="grid grid-cols-3 gap-0.5"></div>
            <div id="no-posts-msg" class="hidden py-20 text-center text-[var(--text-sub)]">
                <i data-lucide="camera" class="mx-auto mb-2"></i>
                <p>아직 게시물이 없습니다.</p>
            </div>
        </div>

        <div id="tab-content-reels" class="hidden p-4">
            <iframe src="h_profile.html" style="width:100%;height:80vh;border:none"></iframe>
        </div>

        <div id="tab-content-tags" class="hidden p-4">
            <iframe src="pk_profile.html" style="width:100%;height:80vh;border:none"></iframe>
        </div>

    </main>

</div>

<script src="layout.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, onValue, update, remove, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyAbHwLLXIH8rBQ8gNMVqE5SE208aIbfFZ0",
    authDomain: "pokbattle.firebaseapp.com",
    databaseURL: "https://pokbattle-default-rtdb.firebaseio.com",
    projectId: "pokbattle",
    storageBucket: "pokbattle.firebasestorage.app",
    messagingSenderId: "445300582484",
    appId: "1:445300582484:web:f8f1373a3bbf643face5c1"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let currentUser = null;
let currentOpenPostId = null;

onAuthStateChanged(auth, (user) => {
    if(user) {
        currentUser = user;
        updateProfileUI(user);
        loadMyPosts(user.uid);
        loadFollowStats(user.uid);
    } else {
        location.href = 'home.html';
    }
});

function updateProfileUI(user) {
    document.getElementById('my-profile-name').innerText = user.displayName || "러너";
}

function loadFollowStats(uid) {
    onValue(ref(db, `users/${uid}/followers`), s => {
        document.getElementById('follower-count').innerText = s.exists() ? Object.keys(s.val()).length : 0;
    });
    onValue(ref(db, `users/${uid}/following`), s => {
        document.getElementById('following-count').innerText = s.exists() ? Object.keys(s.val()).length : 0;
    });
}

window.switchTab = function(tab) {
    ['posts','reels','tags'].forEach(t=>{
        document.getElementById(`tab-content-${t}`).classList.add('hidden');
        document.getElementById(`tab-btn-${t}`).className="flex-1 py-3 flex justify-center text-[var(--text-sub)]";
    });
    document.getElementById(`tab-content-${tab}`).classList.remove('hidden');
    document.getElementById(`tab-btn-${tab}`).className="flex-1 py-3 border-b-2 border-[var(--text-main)] flex justify-center";
    lucide.createIcons();
};

lucide.createIcons();
</script>

</body>
</html>



